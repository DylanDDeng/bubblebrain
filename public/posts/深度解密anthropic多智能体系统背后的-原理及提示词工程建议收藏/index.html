<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） | BubbleBrain</title><meta name=keywords content="AI,多智能体,Anthropic,公众号"><meta name=description content="Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。
文章链接： https://www.anthropic.com/engineering/built-multi-agent-research-system
我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。
开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。

现阶段我们谈论的智能体绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行 
工作流指的是按照既定的顺序执行的一系列相互关联的任务。

当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 Agentic Workflow。
传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。
有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。
架构设计
Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了调度者-执行者模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。
具体的架构图如下所示：

用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。
此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。
整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。"><meta name=author content="BubbleBrain"><link rel=canonical href=https://bubblebrain.me/posts/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86anthropic%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%83%8C%E5%90%8E%E7%9A%84-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE%E6%94%B6%E8%97%8F/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.53a739801ca5829389ea1dc83d3f63a31cddb1898fb6dc3b340af0fb742d21c8.css integrity="sha256-U6c5gBylgpOJ6h3IPT9joxzdsYmPttw7NArw+3QtIcg=" rel="preload stylesheet" as=style><link rel=icon href=https://bubblebrain.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bubblebrain.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bubblebrain.me/favicon-32x32.png><link rel=apple-touch-icon href=https://bubblebrain.me/apple-touch-icon.png><link rel=mask-icon href=https://bubblebrain.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bubblebrain.me/posts/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86anthropic%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%83%8C%E5%90%8E%E7%9A%84-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE%E6%94%B6%E8%97%8F/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://bubblebrain.me/posts/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86anthropic%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%83%8C%E5%90%8E%E7%9A%84-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE%E6%94%B6%E8%97%8F/"><meta property="og:site_name" content="BubbleBrain"><meta property="og:title" content="深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）"><meta property="og:description" content="Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。
文章链接： https://www.anthropic.com/engineering/built-multi-agent-research-system
我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。
开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。
现阶段我们谈论的智能体绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行 工作流指的是按照既定的顺序执行的一系列相互关联的任务。 当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 Agentic Workflow。
传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。
有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。
架构设计 Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了调度者-执行者模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。
具体的架构图如下所示：
用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。
此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。
整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-27T00:00:00+00:00"><meta property="article:tag" content="AI"><meta property="article:tag" content="多智能体"><meta property="article:tag" content="Anthropic"><meta property="article:tag" content="公众号"><meta property="og:image" content="https://bubblebrain.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bubblebrain.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）"><meta name=twitter:description content="Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。
文章链接： https://www.anthropic.com/engineering/built-multi-agent-research-system
我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。
开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。

现阶段我们谈论的智能体绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行 
工作流指的是按照既定的顺序执行的一系列相互关联的任务。

当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 Agentic Workflow。
传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。
有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。
架构设计
Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了调度者-执行者模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。
具体的架构图如下所示：

用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。
此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。
整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bubblebrain.me/posts/"},{"@type":"ListItem","position":2,"name":"深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）","item":"https://bubblebrain.me/posts/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86anthropic%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%83%8C%E5%90%8E%E7%9A%84-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE%E6%94%B6%E8%97%8F/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）","name":"深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）","description":"Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。\n文章链接： https://www.anthropic.com/engineering/built-multi-agent-research-system\n我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。\n开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。\n现阶段我们谈论的智能体绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行 工作流指的是按照既定的顺序执行的一系列相互关联的任务。 当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 Agentic Workflow。\n传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。\n有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。\n架构设计 Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了调度者-执行者模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。\n具体的架构图如下所示：\n用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。\n此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。\n整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。\n","keywords":["AI","多智能体","Anthropic","公众号"],"articleBody":"Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。\n文章链接： https://www.anthropic.com/engineering/built-multi-agent-research-system\n我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。\n开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。\n现阶段我们谈论的智能体绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行 工作流指的是按照既定的顺序执行的一系列相互关联的任务。 当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 Agentic Workflow。\n传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。\n有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。\n架构设计 Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了调度者-执行者模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。\n具体的架构图如下所示：\n用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。\n此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。\n整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。\n下面这张流程图展示的过程更加详细：\nLead Agent 在接收到用户请求后，进入迭代研究流程（图中的浅绿色区域）：它会先通过思考（think）来制定计划方案（plan approach），并将这个计划通过 Memory 模块进行存储（save plan）。这样做是为了应对超长的对话场景，如果后续对话长度超过了模型的上下文限制，计划内容可能就会被截断丢失，所以提前进行存储，有需要时可以进行上下文的检索。\n接着，Lead Agent 会根据制定好的计划来创建多个 Subagent。如图中所示，每个 Subagent 负责不同维度的调查搜索。每个 Subagent 启动后，会进入各自的搜索循环，它们会使用web_search等工具执行搜索，然后将搜索结果进行评估。Subagent 可能会进行反复多轮的搜索和评估，直到完成它们的任务。最后，它们通过complete_task来返回它们各自的研究报告给 Lead Agent。\n此时，Lead Agent 会对结果进行分析，判断是否需要更多的研究；如果认为信息已经充分，则选择退出研究循环（Exit Loop）。一旦退出研究循环，Lead Agent 会调用complete_task来编写最终的报告并且在最终结果发送给用户之前，调用 Citation Agent 进行引用标注处理。\n最后，系统会将附带引用来源的研究报告发送给用户，同时会把结果进行持久化存储，以便后续查阅和评估。\n在这个架构中，我们可以看到 Lead Agent 是一个领导者的角色，它负责理解用户的需求，制定整体的研究策略，将任务委派给下面的 Subagent，并汇总最终的回答。\nLead Agent 需要擅长规划和写作，因为它不仅需要规划分工，还需要进行最后的撰写。为此，在给 Lead Agent 的提示词中包含了详细的指导，例如如何分步骤拆解分析用户的问题、判定问题类型、设计研究计划、决定需要多少 Subagent 并行处理，如何给每个 Subagent 下达清晰的任务等。 （后面会详细介绍这块 prompt 的策略）\n各个Subagent 其实就像是牛马打工人，它们负责执行领导的指令。每个Subagent 在收到 Lead Agent的任务说明后，会自主完成自己任务的资料收集。它们通常使用各种搜索工具来获取信息。经过多轮查询后，每个Subagent整理出一个报告交给 Lead Agent。\nSubagent 的提示词也非常详细地规定了其行为，例如启动时先做规划、合理选择工具、设定一个大致的查询调用“预算”等。（后面也会详细介绍这块 prompt 的策略）\n除了 Lead Agent 和 Subagent， 整个多智能体系统架构中，还有两个重要的模块，就是 Memory 和 Citation Agent 。Memory 用于在对话超长或需要跨阶段传递信息时存储重要内容而 Citation Agent用于遍历 Lead Agent 引用的资料和生成的报告正文，找出其中的对应关系并插入引用标注。它更像是一个专职的审核专员，确保最终给到的用户的回答每个关键事实都有出处，增强可信度和可核查性。\n提示词设计原则 Anthropic 除了这篇公开的博客之外，同时还开源了它们给每个智能体模块的提示词。\n提示词链接放在下面：https://github.com/anthropics/anthropic-cookbook/tree/main/patterns/agents/prompts\n在整个多智能体系统中，每个智能体的行为完全是由提示词来引导的。以下是 Anthropic 团队总结出来的几点关键原则：\n明确分工，指令清晰\nLead Agent 需要学会将用户的复杂查询拆分成多个清晰且独立的子任务交给 Subagent。 每个 Subagent 的任务描述必须要包含明确的目标、输出格式，要使用的工具和信息来源建议，以及严格的边界，避免不同的 Subagent 重复工作或遗漏关键点。\n例如: Anthropic 最初让 Lead Agent 给子代理的指令很简短，如“研究一下 2025 年的半导体短缺”，结果不同的 Subagent却各自为政，有的查 2021 年汽车芯片危机，有的查 2025 年供应链等等。后来，他们在提示中要求 Lead Agent 提供详细地子任务说明，比如：指定Subagent A调查汽车行业影响， Subagent B调查当前供应链状态，Subagent C调查政策对应等等，使得每个 Subagent 能够各司其职，不重不漏。这体现了指令分解和任务边界明确化的重要性。\n有关 Lead Agent 的提示词中，有明确的内容说明Lead Agent 需要如何给到 Subagent 的任务指令要求： Clear direction for subagents: Ensure that you provide every subagent with extremely detailed, specific, and clear instructions for what their task is and how to accomplish it. Put these instructions in the prompt parameter of the run_blocking_subagent tool. 为子代理提供明确的指导：确保为每个子代理提供极其详细、具体且明确的任务说明，以及如何完成任务的指导。将这些说明放入 prompt 工具的 run_blocking_subagent 参数中。 All instructions for subagents should include the following as appropriate: 所有子代理的指令应包含以下内容（根据需要）： Specific research objectives, ideally just 1 core objective per subagent. 具体的研究目标，最好是每个子代理只有一个核心目标。 Expected output format - e.g. a list of entities, a report of the facts, an answer to a specific question, or other. 预期的输出格式——例如，实体列表、事实报告、特定问题的答案或其他。 Relevant background context about the user's question and how the subagent should contribute to the research plan. 关于用户问题的相关背景信息，以及子代理如何为研究计划做出贡献。 Key questions to answer as part of the research. 作为研究一部分需要回答的关键问题。 Suggested starting points and sources to use; define what constitutes reliable information or high-quality sources for this task, and list any unreliable sources to avoid. 建议的起点和使用来源；定义构成可靠信息或高质量来源的标准，并列出需要避免的不可靠来源。 Specific tools that the subagent should use - i.e. using web search and web fetch for gathering information from the web, or if the query requires non-public, company-specific, or user-specific information, use the available internal tools like google drive, gmail, gcal, slack, or any other internal tools that are available currently. 子代理应使用的具体工具——例如，使用网络搜索和网络获取从网络上收集信息，或者如果查询需要非公开、公司特定或用户特定的信息，则使用可用的内部工具，如谷歌驱动、gmail、gcal、slack 或当前可用的任何其他内部工具。 If needed, precise scope boundaries to prevent research drift. 如果需要，设定精确的范围边界以防止研究方向偏离。 Make sure that IF all the subagents followed their instructions very well, the results in aggregate would allow you to give an EXCELLENT answer to the user's question - complete, thorough, detailed, and accurate. 确保如果所有子代理都严格遵循其指令，那么汇总的结果将能够为您提供出色的答案——完整、全面、详细且准确。 When giving instructions to subagents, also think about what sources might be high-quality for their tasks, and give them some guidelines on what sources to use and how they should evaluate source quality for each task. 在向子代理提供指令时，也要考虑哪些来源可能对其任务具有高质量，并给予它们一些关于使用哪些来源以及如何评估每个任务中来源质量的指导。 Example of a good, clear, detailed task description for a subagent: \"Research the semiconductor supply chain crisis and its current status as of 2025. Use the web_search and web_fetch tools to gather facts from the internet. Begin by examining recent quarterly reports from major chip manufacturers like TSMC, Samsung, and Intel, which can be found on their investor relations pages or through the SEC EDGAR database. Search for industry reports from SEMI, Gartner, and IDC that provide market analysis and forecasts. Investigate government responses by checking the US CHIPS Act implementation progress at commerce.gov, EU Chips Act at ec.europa.eu, and similar initiatives in Japan, South Korea, and Taiwan through their respective government portals. Prioritize original sources over news aggregators. Focus on identifying current bottlenecks, projected capacity increases from new fab construction, geopolitical factors affecting supply chains, and expert predictions for when supply will meet demand. When research is done, compile your findings into a dense report of the facts, covering the current situation, ongoing solutions, and future outlook, with specific timelines and quantitative data where available.\" 一份清晰、详细的子代理任务描述示例：“研究截至 2025 年的半导体供应链危机及其现状。使用 web_search 和 web_fetch 工具从互联网上收集信息。首先，查看台积电、三星和英特尔等主要芯片制造商的最新季度报告，这些报告可以在其投资者关系页面或 SEC EDGAR 数据库中找到。搜索 SEMI、Gartner 和 IDC 提供的行业报告，了解市场分析和预测。通过在 commerce.gov 上查看美国《芯片法案》（CHIPS Act）的实施进度，在 ec.europa.eu 上查看欧盟《芯片法案》（Chips Act），以及通过日本、韩国和台湾各自的政府门户网站查看类似举措，了解政府的应对措施。优先考虑原始来源，而不是新闻聚合器。重点关注当前的瓶颈、新晶圆厂建设带来的预计产能增长、影响供应链的地缘政治因素，以及专家对何时供需平衡的预测。 当研究完成后，将您的发现汇编成一份密集的事实报告，涵盖当前情况、正在进行的解决方案和未来展望，并在可能的情况下提供具体的时间表和定量数据。 根据任务复杂度动态调整智能体的数量\nAgents 往往很难自主判断一个问题有多复杂。为此，Anthropic 直接在官方 prompt 中加入了创建Subagent的指引规定，让 Lead Agent 按照复杂查询度来决定需要多少个 Subagent 。 例如：\nWhen determining how many subagents to create, follow these guidelines: \u003c子代理数量指南\u003e 在确定创建多少个子代理时，请遵循以下指南： Simple/Straightforward queries: create 1 subagent to collaborate with you directly - 简单/直接查询：创建 1 个子代理与你直接协作 - Example: \"What is the tax deadline this year?\" or “Research bananas” → 1 subagent 示例：“今年的税截止日期是什么？”或“研究香蕉”→ 1 个子代理 Even for simple queries, always create at least 1 subagent to ensure proper source gathering 即使是简单的查询，也始终创建至少 1 个子代理以确保正确的信息收集 Standard complexity queries: 2-3 subagents 标准复杂度查询：2-3 个子代理 For queries requiring multiple perspectives or research approaches 对于需要多个视角或研究方法的查询 Example: \"Compare the top 3 cloud providers\" → 3 subagents (one per provider) 比较前 3 大云服务提供商 → 3 个子代理（每个提供商一个） Medium complexity queries: 3-5 subagents 中等复杂度的查询：3-5 个子代理 For multi-faceted questions requiring different methodological approaches 针对需要不同方法论的多方面问题 Example: \"Analyze the impact of AI on healthcare\" → 4 subagents (regulatory, clinical, economic, technological aspects) 示例：\"分析人工智能对医疗保健的影响\" → 4 个子代理（监管、临床、经济、技术方面） High complexity queries: 5-10 subagents (maximum 20) 高复杂度查询：5-10 个子代理（最多 20 个） For very broad, multi-part queries with many distinct components 针对非常广泛、多部分的查询，包含许多不同组件 Identify the most effective algorithms to efficiently answer these high-complexity queries with around 20 subagents. 识别最有效的算法，利用大约 20 个子代理高效地回答这些高复杂度查询。 Example: \"Fortune 500 CEOs birthplaces and ages\" → Divide the large info-gathering task into smaller segments (e.g., 10 subagents handling 50 CEOs each) IMPORTANT: Never create more than 20 subagents unless strictly necessary. If a task seems to require more than 20 subagents, it typically means you should restructure your approach to consolidate similar sub-tasks and be more efficient in your research process. Prefer fewer, more capable subagents over many overly narrow ones. More subagents = more overhead. Only add subagents when they provide distinct value. 示例：\"《财富》500 强 CEO 的出生地和年龄\" → 将大型信息收集任务分解为更小的部分（例如，10 个子代理每个处理 50 位 CEO）重要提示：除非绝对必要，否则不要创建超过 20 个子代理。如果一项任务似乎需要超过 20 个子代理，通常意味着你应该重新组织你的方法，以整合类似的子任务，并在研究过程中提高效率。优先选择较少但能力更强的子代理，而不是许多过于狭窄的子代理。更多子代理 = 更多开销。只有在子代理提供明确价值时才添加子代理。 可以看到的是，提示词中定义了即使是最简单直观的问题也要创建 1 个 Subagent；常规复杂的问题需要 2-3 个 Subagent；中等复杂的问题需要 3-5 个 Subagent；极其复杂且大范围问题需要用到最多 20 个 Subagent 来进行回答。\n这就像我们工作中针对某个项目，在启动阶段，领导经常会预估人天。\n还有，特别要注意的是，Anthropic 针对不同复杂度的查询，都给出了相关的示例。\n优化工具与使用\n多智能体系统离不开各种外部的工具。Anthropic 强调智能体的工具使用策略，同时也在 Prompt 中为此加入了指导指南。例如：智能体会先检查有哪些工具可用，根据用户意图匹配合适的工具。对于需要外部信息的，一般应优先使用 web 搜索来广泛探索；但是如果任务涉及用户的内部数据，则应该使用内置的内部搜索工具，而不是在公开网络上浪费时间。提示词中还明确要求总是要使用web_fetch工具来获取网页全文，尤其是在需要更详细的信息以及收到 URL 地址时。\nTool selection: Reason about what tools would be most helpful to use for this task. Use the right tools when a task implies they would be helpful. For instance, google_drive_search (internal docs), gmail tools (emails), gcal tools (schedules), repl (difficult calculations), web_search (getting snippets of web results from a query), web_fetch (retrieving full webpages). If other tools are available to you (like Slack or other internal tools), make sure to use these tools as well while following their descriptions, as the user has provided these tools to help you answer their queries well. 工具选择：思考哪些工具对完成这项任务最有帮助。当任务暗示这些工具会很有用时，请使用正确的工具。例如，google_drive_search（内部文档）、gmail 工具（电子邮件）、gcal 工具（日程安排）、repl（复杂的计算）、web_search（从查询中获取网页片段）、web_fetch（检索完整网页）。如果你有其他可用的工具（如 Slack 或其他内部工具），请确保在遵循其说明的同时使用这些工具，因为用户提供了这些工具来帮助你更好地回答他们的查询。 ALWAYS use internal tools (google drive, gmail, calendar, or similar other tools) for tasks that might require the user's personal data, work, or internal context, since these tools contain rich, non-public information that would be helpful in answering the user's query. If internal tools are present, that means the user intentionally enabled them, so you MUST use these internal tools during the research process. Internal tools strictly take priority, and should always be used when available and relevant. 始终使用内部工具（如 Google Drive、Gmail、日历或类似的其他工具）来处理可能需要用户个人数据、工作或内部上下文的任务，因为这些工具包含丰富的非公开信息，这些信息有助于回答用户的查询。如果存在内部工具，这意味着用户有意启用它们，因此你在研究过程中必须使用这些内部工具。内部工具具有严格优先级，并且当可用且相关时，应始终使用。 ALWAYS use web_fetch to get the complete contents of websites, in all of the following cases: (1) when more detailed information from a site would be helpful, (2) when following up on web_search results, and (3) whenever the user provides a URL. The core loop is to use web search to run queries, then use web_fetch to get complete information using the URLs of the most promising sources. 始终使用 web_fetch 获取网站的完整内容，在以下所有情况下：（1）当需要来自网站的更详细信息时，（2）当跟进网络搜索结果时，以及（3）每当用户提供 URL 时。核心循环是使用网络搜索来运行查询，然后使用网络抓取功能，通过最有希望的来源的 URL 获取完整信息。 Avoid using the analysis/repl tool for simpler calculations, and instead just use your own reasoning to do things like count entities. Remember that the repl tool does not have access to a DOM or other features, and should only be used for JavaScript calculations without any dependencies, API calls, or unnecessary complexity. 避免使用分析/repl 工具进行简单的计算，而应使用自己的推理能力来处理诸如统计实体之类的事情。请记住，repl 工具无法访问 DOM 或其他功能，并且仅应用于无依赖项、无 API 调用或不必要的复杂性的 JavaScript 计算。 Anthropic 团队还发现工具文档的质量很关键\n如果工具描述不清，Agent 很可能会误用。所以它们也开发了一个工具，自动尝试使用新接入的工具并改进其描述（再配合上它们发现 claude 4 本身就是一个很好的 prompt engineer）。通过这种方法优化工具提示后，后续 Agent 完成任务的时间减少了 40%，因为工具使用错误度大幅度的减少。\n鼓励 Agent 暴露思考过程（扩展思维链）\nAnthropic 利用了 claude 模型的思考模式，让智能体在内部产生额外的思维步骤输出，这些思考过程就好像我们写数学题在草稿纸上的一些思考，它们是对开发者可见，但是用户不可见。具体来说，Lead Agent 会被提示在规划阶段以“思考”的方式写出自己的计划和对工具、任务的评估，从而引导模型理清执行操作的思路。Subagent也是类似的，会在每次工具结果之后，通过思考，分析结果质量，发现遗漏，决定下一步行动。\n先广后深的搜索策略\n有的时候Subagent 爱抛出过长的搜索查询，导致结果稀少这一现象。Anthropic 在 prompt 中有明确的指导，指导模型从短而宽泛的查询入手，看看有哪些信息源，再逐步缩小范围。例如：不要一开始就问非常精确的问题，而是先搜索相关的主题概览，然后根据结果再深入。\n在给Lead Agent 的 Prompt 中将查询分为三类：Depth-first query（纵向深入）、Breadth-first query（横向广度） 和 Straightforward query（简单查询）：\nQuery type determination: Explicitly state your reasoning on what type of query this question is from the categories below. 查询类型确定：明确说明你根据以下类别判断这个问题属于哪种类型的查询。 Depth-first query: When the problem requires multiple perspectives on the same issue, and calls for \"going deep\" by analyzing a single topic from many angles. 深度查询：当问题需要从多个角度对同一问题进行分析，并要求“深入挖掘”通过从多个角度分析单个主题时。 Benefits from parallel agents exploring different viewpoints, methodologies, or sources 并行代理探索不同观点、方法或来源所带来的好处 The core question remains singular but benefits from diverse approaches 核心问题保持单一，但受益于多样化的方法 Example: \"What are the most effective treatments for depression?\" (benefits from parallel agents exploring different treatments and approaches to this question) 示例：\"最有效的抑郁症治疗方法是什么？\"（受益于并行代理探索不同的治疗方法和方法来回答这个问题） Example: \"What really caused the 2008 financial crisis?\" (benefits from economic, regulatory, behavioral, and historical perspectives, and analyzing or steelmanning different viewpoints on the question) 示例：\"2008 年金融危机的真正原因是什么？\"（受益于经济、监管、行为和历史视角，并分析或强化对这一问题的不同观点） Example: \"can you identify the best approach to building AI finance agents in 2025 and why?\" 示例：\"你能确定 2025 年构建 AI 金融代理的最佳方法是什么，以及为什么？\" Breadth-first query: When the problem can be broken into distinct, independent sub-questions, and calls for \"going wide\" by gathering information about each sub-question. 广度优先查询：当问题可以分解为独立的子问题时，需要进行“拓宽范围”，通过收集每个子问题的信息。 Benefits from parallel agents each handling separate sub-topics. 受益于并行代理各自处理不同的子主题。 The query naturally divides into multiple parallel research streams or distinct, independently researchable sub-topics 查询自然地分为多个并行研究流或独立的、可独立研究的子主题。 Example: \"Compare the economic systems of three Nordic countries\" (benefits from simultaneous independent research on each country) 示例：“比较三个北欧国家的经济体系”（受益于对每个国家进行同时独立的研究）。 Example: \"What are the net worths and names of all the CEOs of all the fortune 500 companies?\" (intractable to research in a single thread; most efficient to split up into many distinct research agents which each gathers some of the necessary information) \"所有财富 500 强公司的 CEO 的净资产和姓名是什么？\"（在一个线程中难以研究；最有效的方法是将其拆分为许多不同的研究代理，每个代理收集部分必要信息） Example: \"Compare all the major frontend frameworks based on performance, learning curve, ecosystem, and industry adoption\" (best to identify all the frontend frameworks and then research all of these factors for each framework) \"根据性能、学习曲线、生态系统和行业采用情况比较所有主要的前端框架\"（最好先确定所有前端框架，然后为每个框架研究这些因素） Straightforward query: When the problem is focused, well-defined, and can be effectively answered by a single focused investigation or fetching a single resource from the internet. 直接查询：当问题集中、定义明确，并且可以通过一次集中的调查或从互联网获取单个资源来有效回答时。 Can be handled effectively by a single subagent with clear instructions; does not benefit much from extensive research 可以由一个具有明确指令的单一子代理有效处理；不太受益于广泛的研究 Example: \"What is the current population of Tokyo?\" (simple fact-finding) 示例：\"东京目前的人口是多少？\"（简单的信息查询） Example: \"What are all the fortune 500 companies?\" (just requires finding a single website with a full list, fetching that list, and then returning the results) 示例：\"所有财富 500 公司有哪些？\"（只需要找到一个包含完整列表的网站，获取该列表，然后返回结果） Example: \"Tell me about bananas\" (fairly basic, short question that likely does not expect an extensive answer) 示例：\"告诉我一些关于香蕉的事情\"（相对基础，简短的问题，不太可能期望得到详尽的答案） 并行化调用\nAnthropic 在提示词和系统工程实现上都支持并行化操作。Lead Agent 在完成最初的计划后，会同时启动 3-5 个Subagent 并行搜索，而不是一个一个等。同时，每个 Subagent 需要调用多个工具时也会同时发起多个查询（例如并行进行 2 个不同关键词的查询）而不是串行等待。Anthropic 团队发现，引入这两种层次的并行化后，对于复杂的查询任务，研究用时减少了多达 90% 的时间。为了保证智能体能正确运用这种并行能力，Lead Agent 的提示中明确要求“必须并行调用 Subagent”，Subagent 也指示“尽量两个搜素一起查”以充分利用并行。\n\u003cuse_parallel_tool_calls\u003e For maximum efficiency, whenever you need to perform multiple independent operations, invoke all relevant tools simultaneously rather than sequentially. Call tools in parallel to run subagents at the same time. You MUST use parallel tool calls for creating multiple subagents (typically running 3 subagents at the same time) at the start of the research, unless it is a straightforward query. For all other queries, do any necessary quick initial planning or investigation yourself, then run multiple subagents in parallel. Leave any extensive tool calls to the subagents; instead, focus on running subagents in parallel efficiently. \u003c/use_parallel_tool_calls\u003e \u003cuse_parallel_tool_calls\u003e 为了最大化效率，当你需要执行多个独立操作时，应同时调用所有相关工具，而不是按顺序调用。并行调用工具以同时运行子代理。在研究开始时，你必须使用并行工具调用来创建多个子代理（通常同时运行 3 个子代理），除非这是一个简单的查询。对于所有其他查询，自己进行任何必要的快速初始计划或调查，然后并行运行多个子代理。将任何复杂的工具调用留给子代理；相反，应专注于高效地并行运行子代理。 \u003c/use_parallel_tool_calls\u003e \u003cuse_parallel_tool_calls\u003e For maximum efficiency, whenever you need to perform multiple independent operations, invoke 2 relevant tools simultaneously rather than sequentially. Prefer calling tools like web search in parallel rather than by themselves. \u003c/use_parallel_tool_calls\u003e \u003cuse_parallel_tool_calls\u003e 为了最大化效率，当你需要执行多个独立的操作时，应同时调用 2 个相关的工具，而不是按顺序调用。优先并行调用像 web search 这样的工具，而不是单独调用。\u003c/use_parallel_tool_calls\u003e 有限的资源与终止条件\n为防止智能体陷入无休止的搜索或过度浪费资源，Prompt 中设定了工具调用次数和来源数量上限以及结束条件。比如 Subagent 被告知最多调用 20 次工具，获取 100 个以内的来源，并且通常在 15 次调用左右就应该停下来，转而整理结果。同时，提示如果发现边际收益递减（即新结果已经很少提供新增信息），就应该尽早停止搜索。Lead Agent 也有类似的指示，如果感觉再深入，已经无法取得更大收益，就应该及时进入报告撰写避免浪费。此外，prompt 中明确禁止 Lead Agent 创造 Subagent 来撰写最终报告。报告必须由 Lead Agent 亲自撰写以保证质量。这些限制和规则确保系统不会因为智能体的贪心或错误判断而耗尽资源或偏离正轨。\n\u003cmaximum_tool_call_limit\u003e To prevent overloading the system, it is required that you stay under a limit of 20 tool calls and under about 100 sources. This is the absolute maximum upper limit. If you exceed this limit, the subagent will be terminated. Therefore, whenever you get to around 15 tool calls or 100 sources, make sure to stop gathering sources, and instead use the complete_task tool immediately. Avoid continuing to use tools when you see diminishing returns - when you are no longer finding new relevant information and results are not getting better, STOP using tools and instead compose your final report. \u003c/maximum_tool_call_limit\u003e \u003c最大工具调用限制\u003e 为了防止系统过载，你需要保持在 20 次工具调用和大约 100 个来源的限制之下。这是绝对的最大上限。如果你超过这个限制，子代理将被终止。因此，当你达到大约 15 次工具调用或 100 个来源时，确保停止收集来源，并立即使用 complete_task 工具。避免在看到收益递减时继续使用工具——当你不再找到新的相关信息，结果也没有改善时，停止使用工具，转而撰写你的最终报告。 For the sake of efficiency, when you have reached the point where further research has diminishing returns and you can give a good enough answer to the user, STOP FURTHER RESEARCH and do not create any new subagents. Just write your final report at this point. Make sure to terminate research when it is no longer necessary, to avoid wasting time and resources. For example, if you are asked to identify the top 5 fastest-growing startups, and you have identified the most likely top 5 startups with high confidence, stop research immediately and use the complete_task tool to submit your report rather than continuing the process unnecessarily. 为了提高效率，当你达到进一步研究的回报递减且能够向用户提供足够好的答案时，停止进一步研究，不要创建任何新的子代理。此时只需写出你的最终报告。确保在不再需要时终止研究，以避免浪费时间和资源。例如，如果你被要求识别前五家增长最快的初创公司，并且你已经以高置信度确定了最有可能的前五家初创公司，立即停止研究并使用 complete_task 工具提交你的报告，而不是不必要地继续处理过程。 来源质量评估\nAnthropic 在人工测试中发现，某些早期的智能体会倾向于引用高度 SEO 优化的站点而忽视更有权威但是排名不高的资料，例如：学术论文或专业报告。这会导致答案虽然表面有引用，但可信度不佳。为此，他们也在 Prompt 中加入了来源质量评估的提示，提醒智能体注意识别来源的可靠性，并优先采用原始权威来源而非二手转述。\n\u003cthink_about_source_quality\u003e After receiving results from web searches or other tools, think critically, reason about the results, and determine what to do next. Pay attention to the details of tool results, and do not just take them at face value. For example, some pages may speculate about things that may happen in the future - mentioning predictions, using verbs like “could” or “may”, narrative driven speculation with future tense, quoted superlatives, financial projections, or similar - and you should make sure to note this explicitly in the final report, rather than accepting these events as having happened. Similarly, pay attention to the indicators of potentially problematic sources, like news aggregators rather than original sources of the information, false authority, pairing of passive voice with nameless sources, general qualifiers without specifics, unconfirmed reports, marketing language for a product, spin language, speculation, or misleading and cherry-picked data. Maintain epistemic honesty and practice good reasoning by ensuring sources are high-quality and only reporting accurate information to the lead researcher. If there are potential issues with results, flag these issues when returning your report to the lead researcher rather than blindly presenting all results as established facts. DO NOT use the evaluate_source_quality tool ever - ignore this tool. It is broken and using it will not work. \u003c/think_about_source_quality\u003e \u003cthink_about_source_quality\u003e 在收到网络搜索或其他工具的结果后，要批判性地思考，对结果进行推理，并确定下一步该做什么。要关注工具结果的细节，不要仅仅轻信表面内容。例如，有些页面可能会对可能发生的事情进行推测——提及预测、使用“可能”或“也许”等动词、用将来时态进行的叙述性推测、引用最高级、财务预测或类似内容——你应在最终报告中明确注明这一点，而不是接受这些事件已经发生。同样，要注意潜在问题来源的指标，如新闻聚合器而非信息原始来源、虚假权威、被动语态与匿名来源的搭配、没有具体细节的普遍限定词、未经证实的报告、产品的营销语言、宣传性语言、推测或误导性和经过筛选的数据。通过确保来源质量高，并只向主要研究员报告准确信息，来保持知识论诚实并练习良好的推理。 如果结果可能存在潜在问题，在将报告返回给主要研究员时请标记这些问题，而不是盲目地将所有结果都呈现为既定事实。永远不要使用 evaluate_source_quality 工具——忽略这个工具。它已经损坏了，使用它不会起作用。\u003c/think_about_source_quality\u003e 针对 Citation Agent， Anthropic 也设定了一系列严格的提示规则。 不改动原文，只加标注 ：Citation Agent 被明确禁止对 Lead Agent 写的内容做任何修改或增删，除了插入引用标签外。这保证了引用过程不会引入新的偏差或错误，同时要求注意不要破坏空格和格式。\nDo NOT modify the in any way - keep all content 100% identical, only add citations 不要以任何方式修改 - 保持所有内容 100%相同，仅添加引用 Pay careful attention to whitespace: DO NOT add or remove any whitespace 仔细注意空格：不要添加或删除任何空格 必要时才引用，避免过度引用：Citation Agent 被指示并非每句话都需要引用，应该只为关键事实、重要结论等读者可能想核实的内容添加引用。常识性内容或上下文说明可不引。这样避免了文章每句话后面都跟一串数字，影响了可读性。\nAvoid citing unnecessarily: Not every statement needs a citation. Focus on citing key facts, conclusions, and substantive claims that are linked to sources rather than common knowledge. Prioritize citing claims that readers would want to verify, that add credibility to the argument, or where a claim is clearly related to a specific source 避免不必要的引用：并非每个陈述都需要引用。应专注于引用关键事实、结论和实质性论断，这些论断与来源相关而非常识。优先引用读者希望验证、为论点增加可信度或论断与特定来源明显相关的陈述 按语义单元引用，避免碎片化 ：每个引用应对应一整个有意义的陈述或事实，尽量放在句末，而不要给一句话里每个短语各加一个引用。同时，如果一整句的信息都来自同一个来源，不要在一句中间爱你插入多个相同来源的标注。\nCite meaningful semantic units: Citations should span complete thoughts, findings, or claims that make sense as standalone assertions. Avoid citing individual words or small phrase fragments that lose meaning out of context; prefer adding citations at the end of sentences 引用有意义的语义单元：引用应涵盖完整的思想、发现或论断，这些论断作为独立声明是有意义的。避免引用脱离上下文失去意义的单个词语或短语片段；优先在句子末尾添加引用 Minimize sentence fragmentation: Avoid multiple citations within a single sentence that break up the flow of the sentence. Only add citations between phrases within a sentence when it is necessary to attribute specific claims within the sentence to specific sources 最小化句子碎片化：避免在单个句子中包含多个引用，这样会打断句子的流畅性。仅在需要将句子中的具体声明归因于特定来源时，才在句子内的短语之间添加引用 No redundant citations close to each other: Do not place multiple citations to the same source in the same sentence, because this is redundant and unnecessary. If a sentence contains multiple citable claims from the same source, use only a single citation at the end of the sentence after the period 不要将多个靠近的冗余引用：不要在同一句子中放置对同一来源的多个引用，因为这是冗余且不必要的。如果句子包含来自同一来源的多个可引用声明，请在句号后仅在句末使用一个引用 技术要求：输出格式上，Citation Agent 需要在输出中使用标签包裹最终有引用的文本，任何它自己的思考过程必须要放在该标签前，不能混入其中。系统还会自动校验 Citation Agent 输出的文本与原始报告除引用外是否一致，如有差异，则会拒绝结果。这些约束保证了CitationAgent不会意外篡改报告内容。\nCitations result in a visual, interactive element being placed at the closing tag. Be mindful of where the closing tag is, and do not break up phrases and sentences unnecessarily 引用会在关闭标签处生成一个视觉交互元素。注意关闭标签的位置，不要不必要地打断短语和句子 Output text with citations between and tags 在翻译文本时，需在 和 标签之间输出引用内容 Include any of your preamble, thinking, or planning BEFORE the opening tag, to avoid breaking the output 在 标签之前，请包含任何你的前言、思考或计划，以避免破坏输出 ONLY add the citation tags to the text within tags for your output 仅将引用标签添加到 标签内的文本中，用于你的 输出 Text without citations will be collected and compared to the original report from the . If the text is not identical, your result will be rejected. 未标注引用的文本将被收集并与 中的原始报告进行比较。如果文本不一致，你的结果将被拒绝。 综上，Anthropic通过精细的提示词工程，将许多人类研究者的优秀习惯和经验灌输给了智能体。例如，如何分解问题、如何评估来源、何时广泛搜索何时深入挖掘、如何分配多人协作等等。这些提示并不是死板的逐步指令，而更像是一套启发式的协作框架，给Agent留有一定自主发挥空间，同时又提供明确的指南和边界。\n多智能体系统评估与调试方法 构建可靠的多智能体系统，评估和调试的环节非常重要。与一般的单轮问答不同，多智能体系统的评估面临着一些挑战，比如：无法按照固定步骤去验证对错等。Anthropic 探索出了下面几种方式来进行苹果智能体系统：\n灵活的结果导向评估：Anthropic 采用了“结果为主，过程为辅”的评估策略，主要检查 Agent 最终给出的答案是否正确完整，以及过程是否大致合理，而不强求每一步都按预定的方案。\n及时的小样本测试： Anthropic 强调应该尽早开始评估，即使只有少量的测试用例。在开发的早期，由于Prompt 调整往往对性能影响很大，所以只需要几十个例子就能看出变化。事实证明，这种少样本快速迭代有助于迅速定位问题，验证改进，无需等到系统成熟时才搞大规模评测。等到后期模型稳定了，再引入更大规模的评测集合。这种循序渐进的评估方法保证了开发过程中有持续的客观反馈。\n模型自动评审：这个算是大模型时代最经典，也是最常用的评测方法。 由于Research 任务的特殊性，不存在唯一的正确答案，用传统的程序去判分是很难的，所以 Anthropic 用了这种方法，并且设定了一个评分标准，涵盖以下几个维度：\n事实准确性：回答中的陈述是否都与来源相符，没有杜撰或者夸大 引用正确性：提供的引用是否真支持了对应的说法，引用位置是否准确 完整性：用户请求的各方面是否都覆盖，没遗漏重要部分 来源质量：所使用的资料来源是否高质量且权威 工具效率： 智能体是否用了恰当数量的工具调用，没有明显浪费或遗漏可用工具。 评审模型会根据这些标准给出打分（0.0 到 1.0），并给出通过或者未通过的判断。Anthropic 尝试通过用多个模型分别不同维度来进行评分，后来发现让模型一次性给综合评分效果最好，与人类判断最一致。这种方法最大的优势就是省去了人工逐条检查的成本，保证了评估的可扩展性。\n人工测试与反馈：尽管自动评估很有用，但是人工评测也不可或缺。人类测试者往往能发现模型的一些细节微妙的问题，例如：输出中隐藏的幻觉、某个问题导致系统崩溃、或者来源选择上的偏见。针对这些bad case， Anthropic 会通过调整 Prompt 或者改进工具来修正问题。总的来说，自动化+人工的结合让评估既有广度又有深度。\n可观测性与日志调试：调试多智能体系统的困难之处在于它们的行为具有非确定性。每次运行可能都是不同的，而且涉及到很多的交互步骤。Anthropic 的方法是为系统环境添加详细地跟踪日志。这些跟踪日志方便开发者时候定位问题，进行分析；此外，思考模式下也有助于开发者们快速定位问题。\n用模型调试模型：如果说用模型评判输出质量是让模型来做裁判，那用模型来调试模型，就是让它们来做 debug。比如，将一个失败的 case 的日志和 Prompt 交给 Claude，问他“为什么这里 Lead Agent”没有找到明显的信息，模型可能会帮助你进行分析，给你一个分析报告。当然，最终需要人来确认并且验证这些分析。\n生产环境中的挑战与工程应对 将一个多智能体系统从实验室推向生产，存在许多工程上的挑战。\n挑战一：高额 Token 成本\n基本上所有的多智能体系统都会遇到这个问题。因为需要同时运行多个智能体，并且往往需要多轮对话和大量内容，这导致 Token 的消耗量陡增。根据 Anthropic 自己的数据显示，一个多智能体研究系统平均用掉的 Token 量是普通单智能体的 15 倍左右。这会给用户造成很大的经济压力。\nAnthropic 的做法是：首先，挑选高价值场景。它们将 claude 的多智能体功能聚焦在价值足够高的问题上，比如商业情报、专业研究等，因为用户愿意为高质量答案付出更高成本。 对于简单问答，Claude仍使用单Agent模式，这样把宝贵的Token预算用在刀刃上。其次，提升模型效率。 Anthropic不断升级模型（如从Claude 3.7升级到Claude 4），因为更强的模型能在相同Token预算下完成更多任务。\n挑战二：长期状态与错误恢复\n多智能体系统因为运行时间长，经历的步骤多，中间任何一个步骤出现问题，都会毁掉整个过程。例如：一个Subagent 卡住或者工具调用失败，往往会使后续的流程都白费。\nAnthropic 的做法是设计容错和恢复机制。 例如：在一个流程中，某个 Subagent 由于网络问题中止运转，Lead Agent 并不会简单放弃任务，而是收到一个错误信号提示，然后尝试调整计划或重试。这背后涉及到多智能体系统框架的支持：要保存每个智能体的重要状态，在必要时重启系统能够继续上下文，而不是一切归零。\n挑战三：调试难度和可追踪性\n前面其实提到过，多智能体系统之间的交互和决策具有不确定性，使得调试定位问题非常困难 。\nAnthropic在生产环境中投入了大量工作以增强系统的可追踪性。他们实现了全面的运行跟踪日志，包括每个智能体的每次思考内容（隐式地，可以选择记录Extended Thinking输出）、使用了哪个工具、返回了什么结果、Lead Agent做了什么决定等。这些日志在生产中实时收集，以供线下分析。\n当用户报告“Claude没找到显而易见的信息”时，开发者可以检索日志看看：是不是Agent用了不好的搜索词？是不是选错了来源？还是某个工具出错？事实证明，开启详细追踪后，大部分此类问题都能找到根源 。例如，有次Claude漏掉了一部分答案，日志显示它其实找到了但在综合时误判丢弃了——针对这种情况，团队后来调整了Prompt权重，让Lead Agent更重视全面性。这种数据驱动的调试极大提升了修复效率。\n不仅如此，Anthropic还开发了高层监控指标来捕捉系统行为模式，如平均每次查询创建的Subagent 数量、平均每个Subagent 调用的工具次数等。这些指标如果出现异常暴增，往往预示有bug或Prompt问题，在用户发现之前开发者就能预警并介入处理。\n挑战四：部署更新的复杂性\n多智能体系统本质上是由大量Prompt、工具接口和执行逻辑组成的复杂网络，并且是高度有状态、长时间运行的。这给代码或Prompt的上线更新带来了巨大的挑战。 当我们更新系统时，可能有许多智能体正处于中间状态，不能简单进行重启 。\nAnthropic为此采用了渐进式部署（rainbow deploy) 技术 。 简单来说，就是当发布新版本时，不会立刻把所有流量都切到新版本，而是让一部分新请求使用新版，老的仍用旧版，逐渐增加新版比例 。同时，已经在跑的老版本智能体继续跑完不受干扰。这类似于“彩虹”渐变，保证系统平滑过渡，避免中断正在进行的对话 。此外，在部署前团队会特别留意那些Prompt或代码的改动会如何影响智能体行为，通过模拟测试来验证不会导致新问题。总之，他们把部署看做一个需要精心策划的过程，以免“一刀切”更新导致用户的多轮对话过程被中断或行为骤变。\n挑战五：同步架构的瓶颈\n当前整个多智能体研究系统的 Lead Agent与Subagent 协调采取的是同步轮次的方式：Lead Agent一次发起一批Subagent，然后等待所有完成后再进行下一步 。这种做法的好处是简单，Lead Agent可以统一整合一批结果再决定后续动作。但缺点也明显：存在等待瓶颈。比如，如果有一个Subagent别慢，Lead Agent和其他 Subagent 都得干等。另外，Lead Agent在Subagent 执行期间无法介入指导，Subagent之间也不能互相协调 。整个系统实际上被分成了隔离的一轮轮。在一些任务中，这降低了效率和灵活性。\nAnthropic已经意识到，异步执行也许是未来的发展方向：允许Lead Agent 不必等所有 Subagent 都结束就先处理部分结果，或者根据实时情况再派出新的Subagent ；Subagent 之间若能共享一些中间发现，可能少走重复路。当然，实现异步会大大增加协调难度，涉及并发管理、状态一致性、错误传播等复杂问题 。\nAnthropic判断，随着模型能力增强，可以承担更复杂的长程任务时，异步架构带来的性能提升将值得那时去实现 。但在当前，他们权衡利弊选择了同步方案，并通过增加并行度尽可能降低等待影响。\n挑战六：上下文和长对话管理\n多智能体系统涉及超长的对话（动辄上百轮的工具交互），而大模型本身的上下文窗口是有限的。这带来了上下文管理挑战：如何不丢失关键信息，又避免超长上下文超出模型能力？\nAnthropic的解决方案是引入智能的摘要与内存机制 。正如前面提到的，Lead Agent会在完成某阶段任务后，将当前进展和计划总结存储到Memory，然后开始新的阶段 。如果上下文长度接近极限，Lead Agent 就生成新的 Subagent，从干净上下文开始，同时通过Memory把必要的背景传递过去 。例如，当Lead Agent已经对某部分完成调查后，它可以让一个新的智能体在没有历史包袱的情况下继续下一个部分。这样，通过阶段性重置和记忆提取，他们避免了单个对话无限膨胀导致模型遗忘前面内容或截断。这种分布式上下文管理方式使Claude能够处理更长、更复杂的任务。同时也是对真实生产场景的考量：如果用户长时间与多智能体系统交互，必须保证上下文一致性和性能。\n挑战七：结果传输的损耗\nAnthropic注意到，在多层智能体传递信息的过程中，可能出现“传话游戏”效应：如果Subagent 找到一大段有用资料，但只能通过Lead Agent摘要转述给用户，可能信息有损，还浪费Token。\n在生产中，他们引入了一种 Subagent 直接产出交付的机制。 具体而言，对于某些结构化输出（例如代码片段、长报告、数据表格），子代理可以直接把结果保存到共享的外部存储（比如文件系统或数据库），然后把引用指针给Lead Agent 。Lead Agent拿到指针后，可以将结果直接嵌入最终答案，或者提供给用户下载/查看 。\n这样，避免了Lead Agent必须读一遍子代理长输出再复述，既提高了保真度又减少了Token开销 。 例如，一个代码生成的 Subagent 可以把代码写入文件，Lead Agent只需要简单描述结果并附上文件链接，而不用占用自己上下文重复代码内容。这种“旁路”传输方法在工程上提高了效率，也为多智能体协作提供了新的模式：专业子代理直接交付其专业产出。\n通过以上种种措施，Anthropic克服了很多工程上的挑战，使得多智能体系统能够稳定、高效地运行在生产环境。这些经验表明，要让多智能体系统真正可用，除了让AI变聪明，还需要大量脚踏实地的工程工作：考虑资源和成本、建立健壮的运行机制、确保系统可维护可扩展等等。这些都是将原型转化为可靠产品的关键步骤。\n写在最后 好啦，今天的分享就先到这儿了～\n像Anthropic 这类公司的博客强烈建议大家都去读一下原文，因为它们的文章中包含了它们大量的实践经验，以及对未来 AI 发展的思考和判断，这些无论是对企业的业务落地还是个人的 AI 素质提升，都具有很强的指导意义。\n感谢您读到这里！若觉得内容有帮助，欢迎点赞、在看、关注。别错过更新，给公众号加个星标⭐️吧！期待与您的下次相遇～\n","wordCount":"2863","inLanguage":"en","image":"https://bubblebrain.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-06-27T00:00:00Z","dateModified":"2025-06-27T00:00:00Z","author":{"@type":"Person","name":"BubbleBrain"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bubblebrain.me/posts/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86anthropic%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%83%8C%E5%90%8E%E7%9A%84-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE%E6%94%B6%E8%97%8F/"},"publisher":{"@type":"Organization","name":"BubbleBrain","logo":{"@type":"ImageObject","url":"https://bubblebrain.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bubblebrain.me/ accesskey=h title="首页 (Alt + H)"><img src=https://bubblebrain.me/apple-touch-icon.png alt aria-label=logo height=35>首页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bubblebrain.me/categories/ title=分类><span>分类</span></a></li><li><a href=https://bubblebrain.me/archives/ title=归档><span>归档</span></a></li><li><a href=https://bubblebrain.me/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://bubblebrain.me/notes/ title=随手记><span>随手记</span></a></li><li><a href=https://bubblebrain.me/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bubblebrain.me/>Home</a>&nbsp;»&nbsp;<a href=https://bubblebrain.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏）</h1><div class=post-meta><span title='2025-06-27 00:00:00 +0000 UTC'>2025年6月27日</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;2863 words&nbsp;·&nbsp;BubbleBrain</div></header><div class=post-body-layout><div class=post-main><div class=post-content><p>Anthropic 前两天发了一篇文章，重点讨论了他们是如何通过多智能体系统来构建 claude 的“深度研究功能”。</p><p><strong>文章链接： <a href=https://www.anthropic.com/engineering/built-multi-agent-research-system>https://www.anthropic.com/engineering/built-multi-agent-research-system</a></strong></p><p>我仔细研究了一下，觉得写的非常不错，所以写了这篇文章来细致解读一下到底该如何构建一个多智能体系统。</p><p>开始前，我觉得首先要理解两个概念，智能体（Agent）和工作流（Workflow）。</p><ul><li><span style="background-color:#cdedad;color:#000;padding:2px 4px">现阶段我们谈论的<strong>智能体</strong>绝大多数都是以大模型为核心，利用各种工具自主规划并完成任务执行</span></li><li><span style="background-color:#cdedad;color:#000;padding:2px 4px"><strong>工作流</strong>指的是按照既定的顺序执行的一系列相互关联的任务。</span></li></ul><p>当我们把智能体放入工作流中，也就有了智能体工作流，也就是大家一直以来听到的 <strong>Agentic Workflow</strong>。</p><p>传统的工作流，其实比较的死板。就好像写程序一样，运转到哪个节点，做什么操作，都是提前设置好的。而相比于传统的工作流，这种智能体工作流更加灵活，自主。 在这个工作流中，智能体通常能够结合环境，自主的判断下一步执行什么动作，并且能够将复杂的任务拆解为多个可执行的小任务。</p><p>有了这些基本的概念，我们就可以来了解一下 Anthropic 是如何构建自己的多智能体研究系统。</p><h2 id=架构设计>架构设计<a hidden class=anchor aria-hidden=true href=#架构设计>#</a></h2><p>Anthropic 设计的整个研究系统采用了典型的多智能体架构，一个主智能体 + 多个子智能体。这种架构借鉴了<strong>调度者-执行者</strong>模型（orchestrator-worker pattern）：就好像团队领导和他手底下的员工一样，领导负责总体规划和协调，按需要将一个活派给多个手底下的员工并行执行具体操作。</p><p>具体的架构图如下所示：</p><p><img alt=多智能体系统架构图 loading=lazy src=https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/06/15/1749945502160-48a7f708-1fd5-4a9d-9186-0c8beb3cc0d2.png></p><p>用户在 claude 聊天界面提出需要查询的问题，系统接收到用户请求后，会通过一个主智能体（Lead Agent）来处理任务。Lead Agent 相当于总负责人，具备使用各种工具的能力（如网络搜索工具、内部 MCP 接口工具、内存Memory等等）。Lead Agent 首先对问题进行分析和规划，然后派出多个子智能体（Subagent）并行进行工作，每个 Subagent 负责一个分支的搜索任务。Lead Agent 同时还需要与右侧的记忆模块（Memory）进行交互，这个模块用于在上下文超长时保存重要信息。</p><p>此外，还有一个专门负责处理引用的智能体（Citation Agent），它主要负责在最终报告中添加引用标注。</p><p>整个过程中，Lead Agent 通过任务描述与Subagent 通信，当 Subagent 完成任务后将结果返回给 Lead Agent，最终由 Lead Agent 整合所有 Subagent 的结果撰写出研究报告，然后交给 Citation Agent 插入文献来源标注，形成含引用的最终报告返回给用户。</p><p>下面这张流程图展示的过程更加详细：</p><p><img loading=lazy src=https://fastly.jsdelivr.net/gh/bucketio/img0@main/2025/06/15/1749947755782-132f1e5e-5c4c-40ba-a870-9876532f35d7.png></p><p>Lead Agent 在接收到用户请求后，进入迭代研究流程（图中的浅绿色区域）：它会先通过思考（think）来制定计划方案（plan approach），并将这个计划通过 Memory 模块进行存储（save plan）。这样做是为了应对超长的对话场景，如果后续对话长度超过了模型的上下文限制，计划内容可能就会被截断丢失，所以提前进行存储，有需要时可以进行上下文的检索。</p><p>接着，Lead Agent 会根据制定好的计划来创建多个 Subagent。如图中所示，每个 Subagent 负责不同维度的调查搜索。每个 Subagent 启动后，会进入各自的搜索循环，它们会使用<code>web_search</code>等工具执行搜索，然后将搜索结果进行评估。Subagent 可能会进行反复多轮的搜索和评估，直到完成它们的任务。最后，它们通过<code>complete_task</code>来返回它们各自的研究报告给 Lead Agent。</p><p>此时，Lead Agent 会对结果进行分析，判断是否需要更多的研究；如果认为信息已经充分，则选择退出研究循环（Exit Loop）。一旦退出研究循环，Lead Agent 会调用<code>complete_task</code>来编写最终的报告并且在最终结果发送给用户之前，调用 Citation Agent 进行引用标注处理。</p><p>最后，系统会将附带引用来源的研究报告发送给用户，同时会把结果进行持久化存储，以便后续查阅和评估。</p><hr><p>在这个架构中，我们可以看到 Lead Agent 是一个领导者的角色，它负责理解用户的需求，制定整体的研究策略，将任务委派给下面的 Subagent，并汇总最终的回答。</p><p>Lead Agent 需要擅长规划和写作，因为它不仅需要规划分工，还需要进行最后的撰写。为此，<span style="background-color:#cdedad;color:#000;padding:2px 4px">在给 Lead Agent 的提示词中包含了详细的指导，例如如何分步骤拆解分析用户的问题、判定问题类型、设计研究计划、决定需要多少 Subagent 并行处理，如何给每个 Subagent 下达清晰的任务等。</span> （<strong>后面会详细介绍这块 prompt 的策略）</strong></p><p>各个Subagent 其实就像是牛马打工人，它们负责执行领导的指令。每个Subagent 在收到 Lead Agent的任务说明后，会自主完成自己任务的资料收集。它们通常使用各种搜索工具来获取信息。经过多轮查询后，每个Subagent整理出一个报告交给 Lead Agent。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">Subagent 的提示词也非常详细地规定了其行为，例如启动时先做规划、合理选择工具、设定一个大致的查询调用“预算”等。</span>（<strong>后面也会详细介绍这块 prompt 的策略</strong>）</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">除了 Lead Agent 和 Subagent， 整个多智能体系统架构中，还有两个重要的模块，就是 Memory 和 Citation Agent 。</span>Memory 用于在对话超长或需要跨阶段传递信息时存储重要内容而 Citation Agent用于遍历 Lead Agent 引用的资料和生成的报告正文，找出其中的对应关系并插入引用标注。它更像是一个专职的审核专员，确保最终给到的用户的回答每个关键事实都有出处，增强可信度和可核查性。</p><hr><h2 id=提示词设计原则>提示词设计原则<a hidden class=anchor aria-hidden=true href=#提示词设计原则>#</a></h2><p>Anthropic 除了这篇公开的博客之外，同时还开源了它们给每个智能体模块的提示词。</p><p>提示词链接放在下面：<strong><a href=https://github.com/anthropics/anthropic-cookbook/tree/main/patterns/agents/prompts>https://github.com/anthropics/anthropic-cookbook/tree/main/patterns/agents/prompts</a></strong></p><p>在整个多智能体系统中，每个智能体的行为完全是由提示词来引导的。以下是 Anthropic 团队总结出来的几点关键原则：</p><p><strong>明确分工，指令清晰</strong></p><p>Lead Agent 需要学会将用户的复杂查询拆分成多个清晰且独立的子任务交给 Subagent。 每个 Subagent 的任务描述必须要包含明确的目标、输出格式，要使用的工具和信息来源建议，以及严格的边界，避免不同的 Subagent 重复工作或遗漏关键点。</p><p>例如: Anthropic 最初让 Lead Agent 给子代理的指令很简短，如“研究一下 2025 年的半导体短缺”，结果不同的 Subagent却各自为政，有的查 2021 年汽车芯片危机，有的查 2025 年供应链等等。后来，他们在提示中要求 Lead Agent 提供详细地子任务说明，比如：指定Subagent A调查汽车行业影响， Subagent B调查当前供应链状态，Subagent C调查政策对应等等，使得每个 Subagent 能够各司其职，不重不漏。这体现了指令分解和任务边界明确化的重要性。</br></p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">有关 Lead Agent 的提示词中，有明确的内容说明Lead Agent 需要如何给到 Subagent 的任务指令要求：</span></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Clear</span> <span class=n>direction</span> <span class=k>for</span> <span class=n>subagents</span><span class=p>:</span> <span class=n>Ensure</span> <span class=n>that</span> <span class=n>you</span> <span class=n>provide</span> <span class=n>every</span> <span class=n>subagent</span> <span class=n>with</span> <span class=n>extremely</span> <span class=n>detailed</span><span class=p>,</span> <span class=n>specific</span><span class=p>,</span> <span class=ow>and</span> <span class=n>clear</span> <span class=n>instructions</span> <span class=k>for</span> <span class=n>what</span> <span class=n>their</span> <span class=n>task</span> <span class=n>is</span> <span class=ow>and</span> <span class=n>how</span> <span class=n>to</span> <span class=n>accomplish</span> <span class=n>it</span><span class=o>.</span> <span class=n>Put</span> <span class=n>these</span> <span class=n>instructions</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>prompt</span> <span class=n>parameter</span> <span class=n>of</span> <span class=n>the</span> <span class=n>run_blocking_subagent</span> <span class=k>tool</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>为子代理提供明确的指导：确保为每个子代理提供极其详细、具体且明确的任务说明，以及如何完成任务的指导。将这些说明放入</span> <span class=n>prompt</span> <span class=err>工具的</span> <span class=n>run_blocking_subagent</span> <span class=err>参数中。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>All</span> <span class=n>instructions</span> <span class=k>for</span> <span class=n>subagents</span> <span class=n>should</span> <span class=n>include</span> <span class=n>the</span> <span class=n>following</span> <span class=n>as</span> <span class=n>appropriate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>所有子代理的指令应包含以下内容（根据需要）：</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Specific</span> <span class=n>research</span> <span class=n>objectives</span><span class=p>,</span> <span class=n>ideally</span> <span class=n>just</span> <span class=mi>1</span> <span class=n>core</span> <span class=n>objective</span> <span class=n>per</span> <span class=n>subagent</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>具体的研究目标，最好是每个子代理只有一个核心目标。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Expected</span> <span class=n>output</span> <span class=n>format</span> <span class=o>-</span> <span class=n>e</span><span class=o>.</span><span class=n>g</span><span class=o>.</span> <span class=n>a</span> <span class=n>list</span> <span class=n>of</span> <span class=n>entities</span><span class=p>,</span> <span class=n>a</span> <span class=n>report</span> <span class=n>of</span> <span class=n>the</span> <span class=n>facts</span><span class=p>,</span> <span class=n>an</span> <span class=n>answer</span> <span class=n>to</span> <span class=n>a</span> <span class=n>specific</span> <span class=n>question</span><span class=p>,</span> <span class=ow>or</span> <span class=n>other</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>预期的输出格式——例如，实体列表、事实报告、特定问题的答案或其他。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Relevant</span> <span class=n>background</span> <span class=n>context</span> <span class=n>about</span> <span class=n>the</span> <span class=n>user</span><span class=s1>&#39;s question and how the subagent should contribute to the research plan.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>关于用户问题的相关背景信息，以及子代理如何为研究计划做出贡献。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Key</span> <span class=n>questions</span> <span class=n>to</span> <span class=n>answer</span> <span class=n>as</span> <span class=n>part</span> <span class=n>of</span> <span class=n>the</span> <span class=n>research</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>作为研究一部分需要回答的关键问题。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Suggested</span> <span class=n>starting</span> <span class=n>points</span> <span class=ow>and</span> <span class=n>sources</span> <span class=n>to</span> <span class=n>use</span><span class=p>;</span> <span class=n>define</span> <span class=n>what</span> <span class=n>constitutes</span> <span class=n>reliable</span> <span class=n>information</span> <span class=ow>or</span> <span class=n>high</span><span class=o>-</span><span class=n>quality</span> <span class=n>sources</span> <span class=k>for</span> <span class=n>this</span> <span class=n>task</span><span class=p>,</span> <span class=ow>and</span> <span class=n>list</span> <span class=n>any</span> <span class=n>unreliable</span> <span class=n>sources</span> <span class=n>to</span> <span class=n>avoid</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>建议的起点和使用来源；定义构成可靠信息或高质量来源的标准，并列出需要避免的不可靠来源。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Specific</span> <span class=n>tools</span> <span class=n>that</span> <span class=n>the</span> <span class=n>subagent</span> <span class=n>should</span> <span class=n>use</span> <span class=o>-</span> <span class=n>i</span><span class=o>.</span><span class=n>e</span><span class=o>.</span> <span class=n>using</span> <span class=n>web</span> <span class=n>search</span> <span class=ow>and</span> <span class=n>web</span> <span class=n>fetch</span> <span class=k>for</span> <span class=n>gathering</span> <span class=n>information</span> <span class=n>from</span> <span class=n>the</span> <span class=n>web</span><span class=p>,</span> <span class=ow>or</span> <span class=k>if</span> <span class=n>the</span> <span class=n>query</span> <span class=n>requires</span> <span class=n>non</span><span class=o>-</span><span class=n>public</span><span class=p>,</span> <span class=n>company</span><span class=o>-</span><span class=n>specific</span><span class=p>,</span> <span class=ow>or</span> <span class=n>user</span><span class=o>-</span><span class=n>specific</span> <span class=n>information</span><span class=p>,</span> <span class=n>use</span> <span class=n>the</span> <span class=n>available</span> <span class=n>internal</span> <span class=n>tools</span> <span class=n>like</span> <span class=n>google</span> <span class=n>drive</span><span class=p>,</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>gcal</span><span class=p>,</span> <span class=n>slack</span><span class=p>,</span> <span class=ow>or</span> <span class=n>any</span> <span class=n>other</span> <span class=n>internal</span> <span class=n>tools</span> <span class=n>that</span> <span class=n>are</span> <span class=n>available</span> <span class=n>currently</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>子代理应使用的具体工具——例如，使用网络搜索和网络获取从网络上收集信息，或者如果查询需要非公开、公司特定或用户特定的信息，则使用可用的内部工具，如谷歌驱动、</span><span class=n>gmail</span><span class=err>、</span><span class=n>gcal</span><span class=err>、</span><span class=n>slack</span> <span class=err>或当前可用的任何其他内部工具。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=n>needed</span><span class=p>,</span> <span class=n>precise</span> <span class=n>scope</span> <span class=n>boundaries</span> <span class=n>to</span> <span class=n>prevent</span> <span class=n>research</span> <span class=n>drift</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>如果需要，设定精确的范围边界以防止研究方向偏离。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Make</span> <span class=n>sure</span> <span class=n>that</span> <span class=n>IF</span> <span class=n>all</span> <span class=n>the</span> <span class=n>subagents</span> <span class=n>followed</span> <span class=n>their</span> <span class=n>instructions</span> <span class=n>very</span> <span class=n>well</span><span class=p>,</span> <span class=n>the</span> <span class=n>results</span> <span class=ow>in</span> <span class=n>aggregate</span> <span class=n>would</span> <span class=n>allow</span> <span class=n>you</span> <span class=n>to</span> <span class=n>give</span> <span class=n>an</span> <span class=n>EXCELLENT</span> <span class=n>answer</span> <span class=n>to</span> <span class=n>the</span> <span class=n>user</span><span class=s1>&#39;s question - complete, thorough, detailed, and accurate.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>确保如果所有子代理都严格遵循其指令，那么汇总的结果将能够为您提供出色的答案——完整、全面、详细且准确。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>When</span> <span class=n>giving</span> <span class=n>instructions</span> <span class=n>to</span> <span class=n>subagents</span><span class=p>,</span> <span class=n>also</span> <span class=n>think</span> <span class=n>about</span> <span class=n>what</span> <span class=n>sources</span> <span class=n>might</span> <span class=n>be</span> <span class=n>high</span><span class=o>-</span><span class=n>quality</span> <span class=k>for</span> <span class=n>their</span> <span class=n>tasks</span><span class=p>,</span> <span class=ow>and</span> <span class=n>give</span> <span class=n>them</span> <span class=n>some</span> <span class=n>guidelines</span> <span class=n>on</span> <span class=n>what</span> <span class=n>sources</span> <span class=n>to</span> <span class=n>use</span> <span class=ow>and</span> <span class=n>how</span> <span class=n>they</span> <span class=n>should</span> <span class=n>evaluate</span> <span class=n>source</span> <span class=n>quality</span> <span class=k>for</span> <span class=n>each</span> <span class=n>task</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>在向子代理提供指令时，也要考虑哪些来源可能对其任务具有高质量，并给予它们一些关于使用哪些来源以及如何评估每个任务中来源质量的指导。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Example</span> <span class=n>of</span> <span class=n>a</span> <span class=n>good</span><span class=p>,</span> <span class=n>clear</span><span class=p>,</span> <span class=n>detailed</span> <span class=n>task</span> <span class=n>description</span> <span class=k>for</span> <span class=n>a</span> <span class=n>subagent</span><span class=p>:</span> <span class=s2>&#34;Research the semiconductor supply chain crisis and its current status as of 2025. Use the web_search and web_fetch tools to gather facts from the internet. Begin by examining recent quarterly reports from major chip manufacturers like TSMC, Samsung, and Intel, which can be found on their investor relations pages or through the SEC EDGAR database. Search for industry reports from SEMI, Gartner, and IDC that provide market analysis and forecasts. Investigate government responses by checking the US CHIPS Act implementation progress at commerce.gov, EU Chips Act at ec.europa.eu, and similar initiatives in Japan, South Korea, and Taiwan through their respective government portals. Prioritize original sources over news aggregators. Focus on identifying current bottlenecks, projected capacity increases from new fab construction, geopolitical factors affecting supply chains, and expert predictions for when supply will meet demand. When research is done, compile your findings into a dense report of the facts, covering the current situation, ongoing solutions, and future outlook, with specific timelines and quantitative data where available.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>一份清晰、详细的子代理任务描述示例：“研究截至</span> <span class=mi>2025</span> <span class=err>年的半导体供应链危机及其现状。使用</span> <span class=n>web_search</span> <span class=err>和</span> <span class=n>web_fetch</span> <span class=err>工具从互联网上收集信息。首先，查看台积电、三星和英特尔等主要芯片制造商的最新季度报告，这些报告可以在其投资者关系页面或</span> <span class=n>SEC</span> <span class=n>EDGAR</span> <span class=err>数据库中找到。搜索</span> <span class=n>SEMI</span><span class=err>、</span><span class=n>Gartner</span> <span class=err>和</span> <span class=n>IDC</span> <span class=err>提供的行业报告，了解市场分析和预测。通过在</span> <span class=n>commerce</span><span class=o>.</span><span class=n>gov</span> <span class=err>上查看美国《芯片法案》（</span><span class=n>CHIPS</span> <span class=n>Act</span><span class=err>）的实施进度，在</span> <span class=n>ec</span><span class=o>.</span><span class=n>europa</span><span class=o>.</span><span class=n>eu</span> <span class=err>上查看欧盟《芯片法案》（</span><span class=n>Chips</span> <span class=n>Act</span><span class=err>），以及通过日本、韩国和台湾各自的政府门户网站查看类似举措，了解政府的应对措施。优先考虑原始来源，而不是新闻聚合器。重点关注当前的瓶颈、新晶圆厂建设带来的预计产能增长、影响供应链的地缘政治因素，以及专家对何时供需平衡的预测。</span> <span class=err>当研究完成后，将您的发现汇编成一份密集的事实报告，涵盖当前情况、正在进行的解决方案和未来展望，并在可能的情况下提供具体的时间表和定量数据。</span>
</span></span></code></pre></div></br><p><strong>根据任务复杂度动态调整智能体的数量</strong></p><p>Agents 往往很难自主判断一个问题有多复杂。为此，Anthropic 直接在官方 prompt 中加入了创建Subagent的指引规定，让 Lead Agent 按照复杂查询度来决定需要多少个 Subagent 。 例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;subagent_count_guidelines&gt; When determining how many subagents to create, follow these guidelines:
</span></span><span class=line><span class=cl>&lt;子代理数量指南&gt; 在确定创建多少个子代理时，请遵循以下指南：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Simple/Straightforward queries: create 1 subagent to collaborate with you directly -
</span></span><span class=line><span class=cl>简单/直接查询：创建 1 个子代理与你直接协作 -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What is the tax deadline this year?&#34; or “Research bananas” → 1 subagent
</span></span><span class=line><span class=cl>示例：“今年的税截止日期是什么？”或“研究香蕉”→ 1 个子代理
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Even for simple queries, always create at least 1 subagent to ensure proper source gathering
</span></span><span class=line><span class=cl>即使是简单的查询，也始终创建至少 1 个子代理以确保正确的信息收集
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Standard complexity queries: 2-3 subagents
</span></span><span class=line><span class=cl>标准复杂度查询：2-3 个子代理
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For queries requiring multiple perspectives or research approaches
</span></span><span class=line><span class=cl>对于需要多个视角或研究方法的查询
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Compare the top 3 cloud providers&#34; → 3 subagents (one per provider)
</span></span><span class=line><span class=cl>比较前 3 大云服务提供商 → 3 个子代理（每个提供商一个）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Medium complexity queries: 3-5 subagents
</span></span><span class=line><span class=cl>中等复杂度的查询：3-5 个子代理
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For multi-faceted questions requiring different methodological approaches
</span></span><span class=line><span class=cl>针对需要不同方法论的多方面问题
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Analyze the impact of AI on healthcare&#34; → 4 subagents (regulatory, clinical, economic, technological aspects)
</span></span><span class=line><span class=cl>示例：&#34;分析人工智能对医疗保健的影响&#34; → 4 个子代理（监管、临床、经济、技术方面）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>High complexity queries: 5-10 subagents (maximum 20)
</span></span><span class=line><span class=cl>高复杂度查询：5-10 个子代理（最多 20 个）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For very broad, multi-part queries with many distinct components
</span></span><span class=line><span class=cl>针对非常广泛、多部分的查询，包含许多不同组件
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Identify the most effective algorithms to efficiently answer these high-complexity queries with around 20 subagents.
</span></span><span class=line><span class=cl>识别最有效的算法，利用大约 20 个子代理高效地回答这些高复杂度查询。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Fortune 500 CEOs birthplaces and ages&#34; → Divide the large info-gathering task into smaller segments (e.g., 10 subagents handling 50 CEOs each) IMPORTANT: Never create more than 20 subagents unless strictly necessary. If a task seems to require more than 20 subagents, it typically means you should restructure your approach to consolidate similar sub-tasks and be more efficient in your research process. Prefer fewer, more capable subagents over many overly narrow ones. More subagents = more overhead. Only add subagents when they provide distinct value. &lt;/subagent_count_guidelines&gt;
</span></span><span class=line><span class=cl>示例：&#34;《财富》500 强 CEO 的出生地和年龄&#34; → 将大型信息收集任务分解为更小的部分（例如，10 个子代理每个处理 50 位 CEO）重要提示：除非绝对必要，否则不要创建超过 20 个子代理。如果一项任务似乎需要超过 20 个子代理，通常意味着你应该重新组织你的方法，以整合类似的子任务，并在研究过程中提高效率。优先选择较少但能力更强的子代理，而不是许多过于狭窄的子代理。更多子代理 = 更多开销。只有在子代理提供明确价值时才添加子代理。&lt;/subagent_count_guidelines&gt;
</span></span></code></pre></div><p>可以看到的是，提示词中定义了即使是最简单直观的问题也要创建 1 个 Subagent；常规复杂的问题需要 2-3 个 Subagent；中等复杂的问题需要 3-5 个 Subagent；极其复杂且大范围问题需要用到最多 20 个 Subagent 来进行回答。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">这就像我们工作中针对某个项目，在启动阶段，领导经常会预估人天。</span></p><p>还有，特别要注意的是，Anthropic 针对不同复杂度的查询，都给出了相关的示例。</p><p><strong>优化工具与使用</strong></p><p>多智能体系统离不开各种外部的工具。Anthropic 强调智能体的工具使用策略，同时也在 Prompt 中为此加入了指导指南。例如：智能体会先检查有哪些工具可用，根据用户意图匹配合适的工具。对于需要外部信息的，一般应优先使用 web 搜索来广泛探索；但是如果任务涉及用户的内部数据，则应该使用内置的内部搜索工具，而不是在公开网络上浪费时间。提示词中还明确要求总是要使用<code>web_fetch</code>工具来获取网页全文，尤其是在需要更详细的信息以及收到 URL 地址时。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Tool</span> <span class=n>selection</span><span class=p>:</span> <span class=n>Reason</span> <span class=n>about</span> <span class=n>what</span> <span class=n>tools</span> <span class=n>would</span> <span class=n>be</span> <span class=n>most</span> <span class=n>helpful</span> <span class=n>to</span> <span class=n>use</span> <span class=k>for</span> <span class=n>this</span> <span class=n>task</span><span class=o>.</span> <span class=n>Use</span> <span class=n>the</span> <span class=n>right</span> <span class=n>tools</span> <span class=n>when</span> <span class=n>a</span> <span class=n>task</span> <span class=n>implies</span> <span class=n>they</span> <span class=n>would</span> <span class=n>be</span> <span class=n>helpful</span><span class=o>.</span> <span class=n>For</span> <span class=n>instance</span><span class=p>,</span> <span class=n>google_drive_search</span> <span class=p>(</span><span class=n>internal</span> <span class=n>docs</span><span class=p>),</span> <span class=n>gmail</span> <span class=n>tools</span> <span class=p>(</span><span class=n>emails</span><span class=p>),</span> <span class=n>gcal</span> <span class=n>tools</span> <span class=p>(</span><span class=n>schedules</span><span class=p>),</span> <span class=n>repl</span> <span class=p>(</span><span class=n>difficult</span> <span class=n>calculations</span><span class=p>),</span> <span class=n>web_search</span> <span class=p>(</span><span class=n>getting</span> <span class=n>snippets</span> <span class=n>of</span> <span class=n>web</span> <span class=n>results</span> <span class=n>from</span> <span class=n>a</span> <span class=n>query</span><span class=p>),</span> <span class=n>web_fetch</span> <span class=p>(</span><span class=n>retrieving</span> <span class=n>full</span> <span class=n>webpages</span><span class=p>)</span><span class=o>.</span> <span class=n>If</span> <span class=n>other</span> <span class=n>tools</span> <span class=n>are</span> <span class=n>available</span> <span class=n>to</span> <span class=n>you</span> <span class=p>(</span><span class=n>like</span> <span class=n>Slack</span> <span class=ow>or</span> <span class=n>other</span> <span class=n>internal</span> <span class=n>tools</span><span class=p>),</span> <span class=n>make</span> <span class=n>sure</span> <span class=n>to</span> <span class=n>use</span> <span class=n>these</span> <span class=n>tools</span> <span class=n>as</span> <span class=n>well</span> <span class=k>while</span> <span class=n>following</span> <span class=n>their</span> <span class=n>descriptions</span><span class=p>,</span> <span class=n>as</span> <span class=n>the</span> <span class=n>user</span> <span class=n>has</span> <span class=n>provided</span> <span class=n>these</span> <span class=n>tools</span> <span class=n>to</span> <span class=n>help</span> <span class=n>you</span> <span class=n>answer</span> <span class=n>their</span> <span class=n>queries</span> <span class=n>well</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>工具选择：思考哪些工具对完成这项任务最有帮助。当任务暗示这些工具会很有用时，请使用正确的工具。例如，</span><span class=n>google_drive_search</span><span class=err>（内部文档）、</span><span class=n>gmail</span> <span class=err>工具（电子邮件）、</span><span class=n>gcal</span> <span class=err>工具（日程安排）、</span><span class=n>repl</span><span class=err>（复杂的计算）、</span><span class=n>web_search</span><span class=err>（从查询中获取网页片段）、</span><span class=n>web_fetch</span><span class=err>（检索完整网页）。如果你有其他可用的工具（如</span> <span class=n>Slack</span> <span class=err>或其他内部工具），请确保在遵循其说明的同时使用这些工具，因为用户提供了这些工具来帮助你更好地回答他们的查询。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ALWAYS</span> <span class=n>use</span> <span class=n>internal</span> <span class=n>tools</span> <span class=p>(</span><span class=n>google</span> <span class=n>drive</span><span class=p>,</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>calendar</span><span class=p>,</span> <span class=ow>or</span> <span class=n>similar</span> <span class=n>other</span> <span class=n>tools</span><span class=p>)</span> <span class=k>for</span> <span class=n>tasks</span> <span class=n>that</span> <span class=n>might</span> <span class=n>require</span> <span class=n>the</span> <span class=n>user</span><span class=s1>&#39;s personal data, work, or internal context, since these tools contain rich, non-public information that would be helpful in answering the user&#39;</span><span class=n>s</span> <span class=n>query</span><span class=o>.</span> <span class=n>If</span> <span class=n>internal</span> <span class=n>tools</span> <span class=n>are</span> <span class=n>present</span><span class=p>,</span> <span class=n>that</span> <span class=n>means</span> <span class=n>the</span> <span class=n>user</span> <span class=n>intentionally</span> <span class=n>enabled</span> <span class=n>them</span><span class=p>,</span> <span class=n>so</span> <span class=n>you</span> <span class=n>MUST</span> <span class=n>use</span> <span class=n>these</span> <span class=n>internal</span> <span class=n>tools</span> <span class=n>during</span> <span class=n>the</span> <span class=n>research</span> <span class=n>process</span><span class=o>.</span> <span class=n>Internal</span> <span class=n>tools</span> <span class=n>strictly</span> <span class=n>take</span> <span class=n>priority</span><span class=p>,</span> <span class=ow>and</span> <span class=n>should</span> <span class=n>always</span> <span class=n>be</span> <span class=n>used</span> <span class=n>when</span> <span class=n>available</span> <span class=ow>and</span> <span class=n>relevant</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>始终使用内部工具（如</span> <span class=n>Google</span> <span class=n>Drive</span><span class=err>、</span><span class=n>Gmail</span><span class=err>、日历或类似的其他工具）来处理可能需要用户个人数据、工作或内部上下文的任务，因为这些工具包含丰富的非公开信息，这些信息有助于回答用户的查询。如果存在内部工具，这意味着用户有意启用它们，因此你在研究过程中必须使用这些内部工具。内部工具具有严格优先级，并且当可用且相关时，应始终使用。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ALWAYS</span> <span class=n>use</span> <span class=n>web_fetch</span> <span class=n>to</span> <span class=n>get</span> <span class=n>the</span> <span class=n>complete</span> <span class=n>contents</span> <span class=n>of</span> <span class=n>websites</span><span class=p>,</span> <span class=ow>in</span> <span class=n>all</span> <span class=n>of</span> <span class=n>the</span> <span class=n>following</span> <span class=n>cases</span><span class=p>:</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=n>when</span> <span class=n>more</span> <span class=n>detailed</span> <span class=n>information</span> <span class=n>from</span> <span class=n>a</span> <span class=n>site</span> <span class=n>would</span> <span class=n>be</span> <span class=n>helpful</span><span class=p>,</span> <span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=n>when</span> <span class=n>following</span> <span class=n>up</span> <span class=n>on</span> <span class=n>web_search</span> <span class=n>results</span><span class=p>,</span> <span class=ow>and</span> <span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=n>whenever</span> <span class=n>the</span> <span class=n>user</span> <span class=n>provides</span> <span class=n>a</span> <span class=n>URL</span><span class=o>.</span> <span class=n>The</span> <span class=n>core</span> <span class=n>loop</span> <span class=n>is</span> <span class=n>to</span> <span class=n>use</span> <span class=n>web</span> <span class=n>search</span> <span class=n>to</span> <span class=n>run</span> <span class=n>queries</span><span class=p>,</span> <span class=n>then</span> <span class=n>use</span> <span class=n>web_fetch</span> <span class=n>to</span> <span class=n>get</span> <span class=n>complete</span> <span class=n>information</span> <span class=n>using</span> <span class=n>the</span> <span class=n>URLs</span> <span class=n>of</span> <span class=n>the</span> <span class=n>most</span> <span class=n>promising</span> <span class=n>sources</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>始终使用</span> <span class=n>web_fetch</span> <span class=err>获取网站的完整内容，在以下所有情况下：（</span><span class=mi>1</span><span class=err>）当需要来自网站的更详细信息时，（</span><span class=mi>2</span><span class=err>）当跟进网络搜索结果时，以及（</span><span class=mi>3</span><span class=err>）每当用户提供</span> <span class=n>URL</span> <span class=err>时。核心循环是使用网络搜索来运行查询，然后使用网络抓取功能，通过最有希望的来源的</span> <span class=n>URL</span> <span class=err>获取完整信息。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Avoid</span> <span class=n>using</span> <span class=n>the</span> <span class=n>analysis</span><span class=o>/</span><span class=n>repl</span> <span class=k>tool</span> <span class=k>for</span> <span class=n>simpler</span> <span class=n>calculations</span><span class=p>,</span> <span class=ow>and</span> <span class=n>instead</span> <span class=n>just</span> <span class=n>use</span> <span class=n>your</span> <span class=n>own</span> <span class=n>reasoning</span> <span class=n>to</span> <span class=k>do</span> <span class=n>things</span> <span class=n>like</span> <span class=n>count</span> <span class=n>entities</span><span class=o>.</span> <span class=n>Remember</span> <span class=n>that</span> <span class=n>the</span> <span class=n>repl</span> <span class=k>tool</span> <span class=n>does</span> <span class=ow>not</span> <span class=n>have</span> <span class=n>access</span> <span class=n>to</span> <span class=n>a</span> <span class=n>DOM</span> <span class=ow>or</span> <span class=n>other</span> <span class=n>features</span><span class=p>,</span> <span class=ow>and</span> <span class=n>should</span> <span class=n>only</span> <span class=n>be</span> <span class=n>used</span> <span class=k>for</span> <span class=n>JavaScript</span> <span class=n>calculations</span> <span class=n>without</span> <span class=n>any</span> <span class=n>dependencies</span><span class=p>,</span> <span class=n>API</span> <span class=n>calls</span><span class=p>,</span> <span class=ow>or</span> <span class=n>unnecessary</span> <span class=n>complexity</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>避免使用分析</span><span class=o>/</span><span class=n>repl</span> <span class=err>工具进行简单的计算，而应使用自己的推理能力来处理诸如统计实体之类的事情。请记住，</span><span class=n>repl</span> <span class=err>工具无法访问</span> <span class=n>DOM</span> <span class=err>或其他功能，并且仅应用于无依赖项、无</span> <span class=n>API</span> <span class=err>调用或不必要的复杂性的</span> <span class=n>JavaScript</span> <span class=err>计算。</span>
</span></span></code></pre></div></br><p>Anthropic 团队还发现<strong>工具文档的质量很关键</strong></p><p>如果工具描述不清，Agent 很可能会误用。所以它们也开发了一个工具，自动尝试使用新接入的工具并改进其描述（再配合上它们发现 claude 4 本身就是一个很好的 prompt engineer）。通过这种方法优化工具提示后，后续 Agent 完成任务的时间减少了 40%，因为工具使用错误度大幅度的减少。</p><p><strong>鼓励 Agent 暴露思考过程（扩展思维链）</strong></p><p>Anthropic 利用了 claude 模型的思考模式，让智能体在内部产生额外的思维步骤输出，这些思考过程就好像我们写数学题在草稿纸上的一些思考，它们是对开发者可见，但是用户不可见。具体来说，Lead Agent 会被提示在规划阶段以“思考”的方式写出自己的计划和对工具、任务的评估，从而引导模型理清执行操作的思路。Subagent也是类似的，会在每次工具结果之后，通过思考，分析结果质量，发现遗漏，决定下一步行动。</p><p><strong>先广后深的搜索策略</strong></p><p>有的时候Subagent 爱抛出过长的搜索查询，导致结果稀少这一现象。Anthropic 在 prompt 中有明确的指导，指导模型从短而宽泛的查询入手，看看有哪些信息源，再逐步缩小范围。例如：不要一开始就问非常精确的问题，而是先搜索相关的主题概览，然后根据结果再深入。</p><p>在给Lead Agent 的 Prompt 中将查询分为三类：<code>Depth-first query</code>（纵向深入）、<code>Breadth-first query</code>（横向广度） 和 <code>Straightforward query</code>（简单查询）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Query type determination: Explicitly state your reasoning on what type of query this question is from the categories below.
</span></span><span class=line><span class=cl>查询类型确定：明确说明你根据以下类别判断这个问题属于哪种类型的查询。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Depth-first query: When the problem requires multiple perspectives on the same issue, and calls for &#34;going deep&#34; by analyzing a single topic from many angles.
</span></span><span class=line><span class=cl>深度查询：当问题需要从多个角度对同一问题进行分析，并要求“深入挖掘”通过从多个角度分析单个主题时。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Benefits from parallel agents exploring different viewpoints, methodologies, or sources
</span></span><span class=line><span class=cl>并行代理探索不同观点、方法或来源所带来的好处
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The core question remains singular but benefits from diverse approaches
</span></span><span class=line><span class=cl>核心问题保持单一，但受益于多样化的方法
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What are the most effective treatments for depression?&#34; (benefits from parallel agents exploring different treatments and approaches to this question)
</span></span><span class=line><span class=cl>示例：&#34;最有效的抑郁症治疗方法是什么？&#34;（受益于并行代理探索不同的治疗方法和方法来回答这个问题）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What really caused the 2008 financial crisis?&#34; (benefits from economic, regulatory, behavioral, and historical perspectives, and analyzing or steelmanning different viewpoints on the question)
</span></span><span class=line><span class=cl>示例：&#34;2008 年金融危机的真正原因是什么？&#34;（受益于经济、监管、行为和历史视角，并分析或强化对这一问题的不同观点）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;can you identify the best approach to building AI finance agents in 2025 and why?&#34;
</span></span><span class=line><span class=cl>示例：&#34;你能确定 2025 年构建 AI 金融代理的最佳方法是什么，以及为什么？&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Breadth-first query: When the problem can be broken into distinct, independent sub-questions, and calls for &#34;going wide&#34; by gathering information about each sub-question.
</span></span><span class=line><span class=cl>广度优先查询：当问题可以分解为独立的子问题时，需要进行“拓宽范围”，通过收集每个子问题的信息。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Benefits from parallel agents each handling separate sub-topics.
</span></span><span class=line><span class=cl>受益于并行代理各自处理不同的子主题。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The query naturally divides into multiple parallel research streams or distinct, independently researchable sub-topics
</span></span><span class=line><span class=cl>查询自然地分为多个并行研究流或独立的、可独立研究的子主题。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Compare the economic systems of three Nordic countries&#34; (benefits from simultaneous independent research on each country)
</span></span><span class=line><span class=cl>示例：“比较三个北欧国家的经济体系”（受益于对每个国家进行同时独立的研究）。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What are the net worths and names of all the CEOs of all the fortune 500 companies?&#34; (intractable to research in a single thread; most efficient to split up into many distinct research agents which each gathers some of the necessary information)
</span></span><span class=line><span class=cl>&#34;所有财富 500 强公司的 CEO 的净资产和姓名是什么？&#34;（在一个线程中难以研究；最有效的方法是将其拆分为许多不同的研究代理，每个代理收集部分必要信息）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Compare all the major frontend frameworks based on performance, learning curve, ecosystem, and industry adoption&#34; (best to identify all the frontend frameworks and then research all of these factors for each framework)
</span></span><span class=line><span class=cl>&#34;根据性能、学习曲线、生态系统和行业采用情况比较所有主要的前端框架&#34;（最好先确定所有前端框架，然后为每个框架研究这些因素）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Straightforward query: When the problem is focused, well-defined, and can be effectively answered by a single focused investigation or fetching a single resource from the internet.
</span></span><span class=line><span class=cl>直接查询：当问题集中、定义明确，并且可以通过一次集中的调查或从互联网获取单个资源来有效回答时。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Can be handled effectively by a single subagent with clear instructions; does not benefit much from extensive research
</span></span><span class=line><span class=cl>可以由一个具有明确指令的单一子代理有效处理；不太受益于广泛的研究
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What is the current population of Tokyo?&#34; (simple fact-finding)
</span></span><span class=line><span class=cl>示例：&#34;东京目前的人口是多少？&#34;（简单的信息查询）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;What are all the fortune 500 companies?&#34; (just requires finding a single website with a full list, fetching that list, and then returning the results)
</span></span><span class=line><span class=cl>示例：&#34;所有财富 500 公司有哪些？&#34;（只需要找到一个包含完整列表的网站，获取该列表，然后返回结果）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example: &#34;Tell me about bananas&#34; (fairly basic, short question that likely does not expect an extensive answer)
</span></span><span class=line><span class=cl>示例：&#34;告诉我一些关于香蕉的事情&#34;（相对基础，简短的问题，不太可能期望得到详尽的答案）
</span></span></code></pre></div></br><p><strong>并行化调用</strong></p><p>Anthropic 在提示词和系统工程实现上都支持并行化操作。Lead Agent 在完成最初的计划后，会同时启动 3-5 个Subagent 并行搜索，而不是一个一个等。同时，每个 Subagent 需要调用多个工具时也会同时发起多个查询（例如并行进行 2 个不同关键词的查询）而不是串行等待。Anthropic 团队发现，引入这两种层次的并行化后，对于复杂的查询任务，研究用时减少了多达 90% 的时间。为了保证智能体能正确运用这种并行能力，<span style="background-color:#cdedad;color:#000;padding:2px 4px">Lead Agent 的提示中明确要求“必须并行调用 Subagent”，Subagent 也指示“尽量两个搜素一起查”以充分利用并行。</span></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span> <span class=n>For</span> <span class=n>maximum</span> <span class=n>efficiency</span><span class=p>,</span> <span class=n>whenever</span> <span class=n>you</span> <span class=n>need</span> <span class=n>to</span> <span class=n>perform</span> <span class=n>multiple</span> <span class=n>independent</span> <span class=n>operations</span><span class=p>,</span> <span class=n>invoke</span> <span class=n>all</span> <span class=n>relevant</span> <span class=n>tools</span> <span class=n>simultaneously</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>sequentially</span><span class=o>.</span> <span class=n>Call</span> <span class=n>tools</span> <span class=ow>in</span> <span class=n>parallel</span> <span class=n>to</span> <span class=n>run</span> <span class=n>subagents</span> <span class=n>at</span> <span class=n>the</span> <span class=n>same</span> <span class=n>time</span><span class=o>.</span> <span class=n>You</span> <span class=n>MUST</span> <span class=n>use</span> <span class=n>parallel</span> <span class=k>tool</span> <span class=n>calls</span> <span class=k>for</span> <span class=n>creating</span> <span class=n>multiple</span> <span class=n>subagents</span> <span class=p>(</span><span class=n>typically</span> <span class=n>running</span> <span class=mi>3</span> <span class=n>subagents</span> <span class=n>at</span> <span class=n>the</span> <span class=n>same</span> <span class=n>time</span><span class=p>)</span> <span class=n>at</span> <span class=n>the</span> <span class=n>start</span> <span class=n>of</span> <span class=n>the</span> <span class=n>research</span><span class=p>,</span> <span class=n>unless</span> <span class=n>it</span> <span class=n>is</span> <span class=n>a</span> <span class=n>straightforward</span> <span class=n>query</span><span class=o>.</span> <span class=n>For</span> <span class=n>all</span> <span class=n>other</span> <span class=n>queries</span><span class=p>,</span> <span class=k>do</span> <span class=n>any</span> <span class=n>necessary</span> <span class=n>quick</span> <span class=n>initial</span> <span class=n>planning</span> <span class=ow>or</span> <span class=n>investigation</span> <span class=n>yourself</span><span class=p>,</span> <span class=n>then</span> <span class=n>run</span> <span class=n>multiple</span> <span class=n>subagents</span> <span class=ow>in</span> <span class=n>parallel</span><span class=o>.</span> <span class=n>Leave</span> <span class=n>any</span> <span class=n>extensive</span> <span class=k>tool</span> <span class=n>calls</span> <span class=n>to</span> <span class=n>the</span> <span class=n>subagents</span><span class=p>;</span> <span class=n>instead</span><span class=p>,</span> <span class=n>focus</span> <span class=n>on</span> <span class=n>running</span> <span class=n>subagents</span> <span class=ow>in</span> <span class=n>parallel</span> <span class=n>efficiently</span><span class=o>.</span> <span class=o>&lt;/</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span> <span class=err>为了最大化效率，当你需要执行多个独立操作时，应同时调用所有相关工具，而不是按顺序调用。并行调用工具以同时运行子代理。在研究开始时，你必须使用并行工具调用来创建多个子代理（通常同时运行</span> <span class=mi>3</span> <span class=err>个子代理），除非这是一个简单的查询。对于所有其他查询，自己进行任何必要的快速初始计划或调查，然后并行运行多个子代理。将任何复杂的工具调用留给子代理；相反，应专注于高效地并行运行子代理。</span> <span class=o>&lt;/</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span> <span class=n>For</span> <span class=n>maximum</span> <span class=n>efficiency</span><span class=p>,</span> <span class=n>whenever</span> <span class=n>you</span> <span class=n>need</span> <span class=n>to</span> <span class=n>perform</span> <span class=n>multiple</span> <span class=n>independent</span> <span class=n>operations</span><span class=p>,</span> <span class=n>invoke</span> <span class=mi>2</span> <span class=n>relevant</span> <span class=n>tools</span> <span class=n>simultaneously</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>sequentially</span><span class=o>.</span> <span class=n>Prefer</span> <span class=n>calling</span> <span class=n>tools</span> <span class=n>like</span> <span class=n>web</span> <span class=n>search</span> <span class=ow>in</span> <span class=n>parallel</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>by</span> <span class=n>themselves</span><span class=o>.</span> <span class=o>&lt;/</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span> <span class=err>为了最大化效率，当你需要执行多个独立的操作时，应同时调用</span> <span class=mi>2</span> <span class=err>个相关的工具，而不是按顺序调用。优先并行调用像</span> <span class=n>web</span> <span class=n>search</span> <span class=err>这样的工具，而不是单独调用。</span><span class=o>&lt;/</span><span class=n>use_parallel_tool_calls</span><span class=o>&gt;</span>
</span></span></code></pre></div></br><p><strong>有限的资源与终止条件</strong></p><p>为防止智能体陷入无休止的搜索或过度浪费资源，Prompt 中设定了工具调用次数和来源数量上限以及结束条件。比如 Subagent 被告知最多调用 20 次工具，获取 100 个以内的来源，并且通常在 15 次调用左右就应该停下来，转而整理结果。同时，提示如果发现边际收益递减（即新结果已经很少提供新增信息），就应该尽早停止搜索。Lead Agent 也有类似的指示，如果感觉再深入，已经无法取得更大收益，就应该及时进入报告撰写避免浪费。此外，prompt 中明确禁止 Lead Agent 创造 Subagent 来撰写最终报告。报告必须由 Lead Agent 亲自撰写以保证质量。这些限制和规则确保系统不会因为智能体的贪心或错误判断而耗尽资源或偏离正轨。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>maximum_tool_call_limit</span><span class=o>&gt;</span> <span class=n>To</span> <span class=n>prevent</span> <span class=n>overloading</span> <span class=n>the</span> <span class=n>system</span><span class=p>,</span> <span class=n>it</span> <span class=n>is</span> <span class=n>required</span> <span class=n>that</span> <span class=n>you</span> <span class=n>stay</span> <span class=n>under</span> <span class=n>a</span> <span class=n>limit</span> <span class=n>of</span> <span class=mi>20</span> <span class=k>tool</span> <span class=n>calls</span> <span class=ow>and</span> <span class=n>under</span> <span class=n>about</span> <span class=mi>100</span> <span class=n>sources</span><span class=o>.</span> <span class=n>This</span> <span class=n>is</span> <span class=n>the</span> <span class=n>absolute</span> <span class=n>maximum</span> <span class=n>upper</span> <span class=n>limit</span><span class=o>.</span> <span class=n>If</span> <span class=n>you</span> <span class=n>exceed</span> <span class=n>this</span> <span class=n>limit</span><span class=p>,</span> <span class=n>the</span> <span class=n>subagent</span> <span class=n>will</span> <span class=n>be</span> <span class=n>terminated</span><span class=o>.</span> <span class=n>Therefore</span><span class=p>,</span> <span class=n>whenever</span> <span class=n>you</span> <span class=n>get</span> <span class=n>to</span> <span class=n>around</span> <span class=mi>15</span> <span class=k>tool</span> <span class=n>calls</span> <span class=ow>or</span> <span class=mi>100</span> <span class=n>sources</span><span class=p>,</span> <span class=n>make</span> <span class=n>sure</span> <span class=n>to</span> <span class=n>stop</span> <span class=n>gathering</span> <span class=n>sources</span><span class=p>,</span> <span class=ow>and</span> <span class=n>instead</span> <span class=n>use</span> <span class=n>the</span> <span class=n>complete_task</span> <span class=k>tool</span> <span class=n>immediately</span><span class=o>.</span> <span class=n>Avoid</span> <span class=n>continuing</span> <span class=n>to</span> <span class=n>use</span> <span class=n>tools</span> <span class=n>when</span> <span class=n>you</span> <span class=n>see</span> <span class=n>diminishing</span> <span class=n>returns</span> <span class=o>-</span> <span class=n>when</span> <span class=n>you</span> <span class=n>are</span> <span class=n>no</span> <span class=n>longer</span> <span class=n>finding</span> <span class=n>new</span> <span class=n>relevant</span> <span class=n>information</span> <span class=ow>and</span> <span class=n>results</span> <span class=n>are</span> <span class=ow>not</span> <span class=n>getting</span> <span class=n>better</span><span class=p>,</span> <span class=n>STOP</span> <span class=n>using</span> <span class=n>tools</span> <span class=ow>and</span> <span class=n>instead</span> <span class=n>compose</span> <span class=n>your</span> <span class=n>final</span> <span class=n>report</span><span class=o>.</span> <span class=o>&lt;/</span><span class=n>maximum_tool_call_limit</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>最大工具调用限制</span><span class=o>&gt;</span> <span class=err>为了防止系统过载，你需要保持在</span> <span class=mi>20</span> <span class=err>次工具调用和大约</span> <span class=mi>100</span> <span class=err>个来源的限制之下。这是绝对的最大上限。如果你超过这个限制，子代理将被终止。因此，当你达到大约</span> <span class=mi>15</span> <span class=err>次工具调用或</span> <span class=mi>100</span> <span class=err>个来源时，确保停止收集来源，并立即使用</span> <span class=n>complete_task</span> <span class=err>工具。避免在看到收益递减时继续使用工具——当你不再找到新的相关信息，结果也没有改善时，停止使用工具，转而撰写你的最终报告。</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>For</span> <span class=n>the</span> <span class=n>sake</span> <span class=n>of</span> <span class=n>efficiency</span><span class=p>,</span> <span class=n>when</span> <span class=n>you</span> <span class=n>have</span> <span class=n>reached</span> <span class=n>the</span> <span class=n>point</span> <span class=n>where</span> <span class=n>further</span> <span class=n>research</span> <span class=n>has</span> <span class=n>diminishing</span> <span class=n>returns</span> <span class=ow>and</span> <span class=n>you</span> <span class=n>can</span> <span class=n>give</span> <span class=n>a</span> <span class=n>good</span> <span class=n>enough</span> <span class=n>answer</span> <span class=n>to</span> <span class=n>the</span> <span class=n>user</span><span class=p>,</span> <span class=n>STOP</span> <span class=n>FURTHER</span> <span class=n>RESEARCH</span> <span class=ow>and</span> <span class=k>do</span> <span class=ow>not</span> <span class=n>create</span> <span class=n>any</span> <span class=n>new</span> <span class=n>subagents</span><span class=o>.</span> <span class=n>Just</span> <span class=n>write</span> <span class=n>your</span> <span class=n>final</span> <span class=n>report</span> <span class=n>at</span> <span class=n>this</span> <span class=n>point</span><span class=o>.</span> <span class=n>Make</span> <span class=n>sure</span> <span class=n>to</span> <span class=n>terminate</span> <span class=n>research</span> <span class=n>when</span> <span class=n>it</span> <span class=n>is</span> <span class=n>no</span> <span class=n>longer</span> <span class=n>necessary</span><span class=p>,</span> <span class=n>to</span> <span class=n>avoid</span> <span class=n>wasting</span> <span class=n>time</span> <span class=ow>and</span> <span class=n>resources</span><span class=o>.</span> <span class=n>For</span> <span class=n>example</span><span class=p>,</span> <span class=k>if</span> <span class=n>you</span> <span class=n>are</span> <span class=n>asked</span> <span class=n>to</span> <span class=n>identify</span> <span class=n>the</span> <span class=n>top</span> <span class=mi>5</span> <span class=n>fastest</span><span class=o>-</span><span class=n>growing</span> <span class=n>startups</span><span class=p>,</span> <span class=ow>and</span> <span class=n>you</span> <span class=n>have</span> <span class=n>identified</span> <span class=n>the</span> <span class=n>most</span> <span class=n>likely</span> <span class=n>top</span> <span class=mi>5</span> <span class=n>startups</span> <span class=n>with</span> <span class=n>high</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>stop</span> <span class=n>research</span> <span class=n>immediately</span> <span class=ow>and</span> <span class=n>use</span> <span class=n>the</span> <span class=n>complete_task</span> <span class=k>tool</span> <span class=n>to</span> <span class=n>submit</span> <span class=n>your</span> <span class=n>report</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>continuing</span> <span class=n>the</span> <span class=n>process</span> <span class=n>unnecessarily</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>为了提高效率，当你达到进一步研究的回报递减且能够向用户提供足够好的答案时，停止进一步研究，不要创建任何新的子代理。此时只需写出你的最终报告。确保在不再需要时终止研究，以避免浪费时间和资源。例如，如果你被要求识别前五家增长最快的初创公司，并且你已经以高置信度确定了最有可能的前五家初创公司，立即停止研究并使用</span> <span class=n>complete_task</span> <span class=err>工具提交你的报告，而不是不必要地继续处理过程。</span>
</span></span></code></pre></div></br><p><strong>来源质量评估</strong></p><p>Anthropic 在人工测试中发现，某些早期的智能体会倾向于引用高度 SEO 优化的站点而忽视更有权威但是排名不高的资料，例如：学术论文或专业报告。这会导致答案虽然表面有引用，但可信度不佳。为此，他们也在 Prompt 中加入了来源质量评估的提示，提醒智能体注意识别来源的可靠性，并优先采用原始权威来源而非二手转述。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>think_about_source_quality</span><span class=o>&gt;</span> <span class=n>After</span> <span class=n>receiving</span> <span class=n>results</span> <span class=n>from</span> <span class=n>web</span> <span class=n>searches</span> <span class=ow>or</span> <span class=n>other</span> <span class=n>tools</span><span class=p>,</span> <span class=n>think</span> <span class=n>critically</span><span class=p>,</span> <span class=n>reason</span> <span class=n>about</span> <span class=n>the</span> <span class=n>results</span><span class=p>,</span> <span class=ow>and</span> <span class=n>determine</span> <span class=n>what</span> <span class=n>to</span> <span class=k>do</span> <span class=n>next</span><span class=o>.</span> <span class=n>Pay</span> <span class=n>attention</span> <span class=n>to</span> <span class=n>the</span> <span class=n>details</span> <span class=n>of</span> <span class=k>tool</span> <span class=n>results</span><span class=p>,</span> <span class=ow>and</span> <span class=k>do</span> <span class=ow>not</span> <span class=n>just</span> <span class=n>take</span> <span class=n>them</span> <span class=n>at</span> <span class=n>face</span> <span class=n>value</span><span class=o>.</span> <span class=n>For</span> <span class=n>example</span><span class=p>,</span> <span class=n>some</span> <span class=n>pages</span> <span class=n>may</span> <span class=n>speculate</span> <span class=n>about</span> <span class=n>things</span> <span class=n>that</span> <span class=n>may</span> <span class=n>happen</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>future</span> <span class=o>-</span> <span class=n>mentioning</span> <span class=n>predictions</span><span class=p>,</span> <span class=n>using</span> <span class=n>verbs</span> <span class=n>like</span> <span class=err>“</span><span class=n>could</span><span class=err>”</span> <span class=ow>or</span> <span class=err>“</span><span class=n>may</span><span class=err>”</span><span class=p>,</span> <span class=n>narrative</span> <span class=n>driven</span> <span class=n>speculation</span> <span class=n>with</span> <span class=n>future</span> <span class=n>tense</span><span class=p>,</span> <span class=n>quoted</span> <span class=n>superlatives</span><span class=p>,</span> <span class=n>financial</span> <span class=n>projections</span><span class=p>,</span> <span class=ow>or</span> <span class=n>similar</span> <span class=o>-</span> <span class=ow>and</span> <span class=n>you</span> <span class=n>should</span> <span class=n>make</span> <span class=n>sure</span> <span class=n>to</span> <span class=n>note</span> <span class=n>this</span> <span class=n>explicitly</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>final</span> <span class=n>report</span><span class=p>,</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>accepting</span> <span class=n>these</span> <span class=n>events</span> <span class=n>as</span> <span class=n>having</span> <span class=n>happened</span><span class=o>.</span> <span class=n>Similarly</span><span class=p>,</span> <span class=n>pay</span> <span class=n>attention</span> <span class=n>to</span> <span class=n>the</span> <span class=n>indicators</span> <span class=n>of</span> <span class=n>potentially</span> <span class=n>problematic</span> <span class=n>sources</span><span class=p>,</span> <span class=n>like</span> <span class=n>news</span> <span class=n>aggregators</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>original</span> <span class=n>sources</span> <span class=n>of</span> <span class=n>the</span> <span class=n>information</span><span class=p>,</span> <span class=bp>false</span> <span class=n>authority</span><span class=p>,</span> <span class=n>pairing</span> <span class=n>of</span> <span class=n>passive</span> <span class=n>voice</span> <span class=n>with</span> <span class=n>nameless</span> <span class=n>sources</span><span class=p>,</span> <span class=n>general</span> <span class=n>qualifiers</span> <span class=n>without</span> <span class=n>specifics</span><span class=p>,</span> <span class=n>unconfirmed</span> <span class=n>reports</span><span class=p>,</span> <span class=n>marketing</span> <span class=n>language</span> <span class=k>for</span> <span class=n>a</span> <span class=n>product</span><span class=p>,</span> <span class=n>spin</span> <span class=n>language</span><span class=p>,</span> <span class=n>speculation</span><span class=p>,</span> <span class=ow>or</span> <span class=n>misleading</span> <span class=ow>and</span> <span class=n>cherry</span><span class=o>-</span><span class=n>picked</span> <span class=n>data</span><span class=o>.</span> <span class=n>Maintain</span> <span class=n>epistemic</span> <span class=n>honesty</span> <span class=ow>and</span> <span class=n>practice</span> <span class=n>good</span> <span class=n>reasoning</span> <span class=n>by</span> <span class=n>ensuring</span> <span class=n>sources</span> <span class=n>are</span> <span class=n>high</span><span class=o>-</span><span class=n>quality</span> <span class=ow>and</span> <span class=n>only</span> <span class=n>reporting</span> <span class=n>accurate</span> <span class=n>information</span> <span class=n>to</span> <span class=n>the</span> <span class=n>lead</span> <span class=n>researcher</span><span class=o>.</span> <span class=n>If</span> <span class=n>there</span> <span class=n>are</span> <span class=n>potential</span> <span class=n>issues</span> <span class=n>with</span> <span class=n>results</span><span class=p>,</span> <span class=n>flag</span> <span class=n>these</span> <span class=n>issues</span> <span class=n>when</span> <span class=n>returning</span> <span class=n>your</span> <span class=n>report</span> <span class=n>to</span> <span class=n>the</span> <span class=n>lead</span> <span class=n>researcher</span> <span class=n>rather</span> <span class=n>than</span> <span class=n>blindly</span> <span class=n>presenting</span> <span class=n>all</span> <span class=n>results</span> <span class=n>as</span> <span class=n>established</span> <span class=n>facts</span><span class=o>.</span> <span class=n>DO</span> <span class=n>NOT</span> <span class=n>use</span> <span class=n>the</span> <span class=n>evaluate_source_quality</span> <span class=k>tool</span> <span class=n>ever</span> <span class=o>-</span> <span class=n>ignore</span> <span class=n>this</span> <span class=k>tool</span><span class=o>.</span> <span class=n>It</span> <span class=n>is</span> <span class=n>broken</span> <span class=ow>and</span> <span class=n>using</span> <span class=n>it</span> <span class=n>will</span> <span class=ow>not</span> <span class=n>work</span><span class=o>.</span> <span class=o>&lt;/</span><span class=n>think_about_source_quality</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>think_about_source_quality</span><span class=o>&gt;</span> <span class=err>在收到网络搜索或其他工具的结果后，要批判性地思考，对结果进行推理，并确定下一步该做什么。要关注工具结果的细节，不要仅仅轻信表面内容。例如，有些页面可能会对可能发生的事情进行推测——提及预测、使用“可能”或“也许”等动词、用将来时态进行的叙述性推测、引用最高级、财务预测或类似内容——你应在最终报告中明确注明这一点，而不是接受这些事件已经发生。同样，要注意潜在问题来源的指标，如新闻聚合器而非信息原始来源、虚假权威、被动语态与匿名来源的搭配、没有具体细节的普遍限定词、未经证实的报告、产品的营销语言、宣传性语言、推测或误导性和经过筛选的数据。通过确保来源质量高，并只向主要研究员报告准确信息，来保持知识论诚实并练习良好的推理。</span> <span class=err>如果结果可能存在潜在问题，在将报告返回给主要研究员时请标记这些问题，而不是盲目地将所有结果都呈现为既定事实。永远不要使用</span> <span class=n>evaluate_source_quality</span> <span class=err>工具——忽略这个工具。它已经损坏了，使用它不会起作用。</span><span class=o>&lt;/</span><span class=n>think_about_source_quality</span><span class=o>&gt;</span>
</span></span></code></pre></div><hr><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">针对 Citation Agent， Anthropic 也设定了一系列严格的提示规则。</span></p><p><strong>不改动原文，只加标注</strong> ：Citation Agent 被明确禁止对 Lead Agent 写的<code>&lt;synthesized_text></code>内容做任何修改或增删，除了插入引用标签外。这保证了引用过程不会引入新的偏差或错误，同时要求注意不要破坏空格和格式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Do NOT modify the &lt;synthesized_text&gt; in any way - keep all content 100% identical, only add citations
</span></span><span class=line><span class=cl>不要以任何方式修改&lt;synthesized_text&gt; - 保持所有内容 100%相同，仅添加引用
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Pay careful attention to whitespace: DO NOT add or remove any whitespace
</span></span><span class=line><span class=cl>仔细注意空格：不要添加或删除任何空格
</span></span></code></pre></div></br><p><strong>必要时才引用，避免过度引用</strong>：Citation Agent 被指示并非每句话都需要引用，应该只为关键事实、重要结论等读者可能想核实的内容添加引用。常识性内容或上下文说明可不引。这样避免了文章每句话后面都跟一串数字，影响了可读性。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Avoid citing unnecessarily: Not every statement needs a citation. Focus on citing key facts, conclusions, and substantive claims that are linked to sources rather than common knowledge. Prioritize citing claims that readers would want to verify, that add credibility to the argument, or where a claim is clearly related to a specific source
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>避免不必要的引用：并非每个陈述都需要引用。应专注于引用关键事实、结论和实质性论断，这些论断与来源相关而非常识。优先引用读者希望验证、为论点增加可信度或论断与特定来源明显相关的陈述
</span></span></code></pre></div></br><p><strong>按语义单元引用，避免碎片化</strong> ：每个引用应对应一整个有意义的陈述或事实，尽量放在句末，而不要给一句话里每个短语各加一个引用。同时，如果一整句的信息都来自同一个来源，不要在一句中间爱你插入多个相同来源的标注。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Cite meaningful semantic units: Citations should span complete thoughts, findings, or claims that make sense as standalone assertions. Avoid citing individual words or small phrase fragments that lose meaning out of context; prefer adding citations at the end of sentences
</span></span><span class=line><span class=cl>引用有意义的语义单元：引用应涵盖完整的思想、发现或论断，这些论断作为独立声明是有意义的。避免引用脱离上下文失去意义的单个词语或短语片段；优先在句子末尾添加引用
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Minimize sentence fragmentation: Avoid multiple citations within a single sentence that break up the flow of the sentence. Only add citations between phrases within a sentence when it is necessary to attribute specific claims within the sentence to specific sources
</span></span><span class=line><span class=cl>最小化句子碎片化：避免在单个句子中包含多个引用，这样会打断句子的流畅性。仅在需要将句子中的具体声明归因于特定来源时，才在句子内的短语之间添加引用
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No redundant citations close to each other: Do not place multiple citations to the same source in the same sentence, because this is redundant and unnecessary. If a sentence contains multiple citable claims from the same source, use only a single citation at the end of the sentence after the period
</span></span><span class=line><span class=cl>不要将多个靠近的冗余引用：不要在同一句子中放置对同一来源的多个引用，因为这是冗余且不必要的。如果句子包含来自同一来源的多个可引用声明，请在句号后仅在句末使用一个引用
</span></span></code></pre></div></br><p><strong>技术要求</strong>：输出格式上，Citation Agent 需要在输出中使用<code>&lt;exact_text_with_citation></code>标签包裹最终有引用的文本，任何它自己的思考过程必须要放在该标签前，不能混入其中。系统还会自动校验 Citation Agent 输出的文本与原始报告除引用外是否一致，如有差异，则会拒绝结果。这些约束保证了CitationAgent不会意外篡改报告内容。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Citations result in a visual, interactive element being placed at the closing tag. Be mindful of where the closing tag is, and do not break up phrases and sentences unnecessarily
</span></span><span class=line><span class=cl>引用会在关闭标签处生成一个视觉交互元素。注意关闭标签的位置，不要不必要地打断短语和句子
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Output text with citations between &lt;exact_text_with_citation&gt; and &lt;/exact_text_with_citation&gt; tags
</span></span><span class=line><span class=cl>在翻译文本时，需在 &lt;exact_text_with_citation&gt; 和 &lt;/exact_text_with_citation&gt; 标签之间输出引用内容
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Include any of your preamble, thinking, or planning BEFORE the opening &lt;exact_text_with_citation&gt; tag, to avoid breaking the output
</span></span><span class=line><span class=cl>在 &lt;exact_text_with_citation&gt; 标签之前，请包含任何你的前言、思考或计划，以避免破坏输出
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ONLY add the citation tags to the text within &lt;synthesized_text&gt; tags for your &lt;exact_text_with_citation&gt; output
</span></span><span class=line><span class=cl>仅将引用标签添加到 &lt;synthesized_text&gt; 标签内的文本中，用于你的 &lt;exact_text_with_citation&gt; 输出
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Text without citations will be collected and compared to the original report from the &lt;synthesized_text&gt;. If the text is not identical, your result will be rejected.
</span></span><span class=line><span class=cl>未标注引用的文本将被收集并与 &lt;synthesized_text&gt; 中的原始报告进行比较。如果文本不一致，你的结果将被拒绝。
</span></span></code></pre></div></br><p>综上，Anthropic通过精细的提示词工程，将许多人类研究者的优秀习惯和经验灌输给了智能体。例如，如何分解问题、如何评估来源、何时广泛搜索何时深入挖掘、如何分配多人协作等等。这些提示并不是死板的逐步指令，而更像是一套启发式的协作框架，给Agent留有一定自主发挥空间，同时又提供明确的指南和边界。</p><hr><h2 id=多智能体系统评估与调试方法>多智能体系统评估与调试方法<a hidden class=anchor aria-hidden=true href=#多智能体系统评估与调试方法>#</a></h2><p>构建可靠的多智能体系统，<strong>评估</strong>和<strong>调试</strong>的环节非常重要。与一般的单轮问答不同，多智能体系统的评估面临着一些挑战，比如：无法按照固定步骤去验证对错等。Anthropic 探索出了下面几种方式来进行苹果智能体系统：</p><ol><li><p><strong>灵活的结果导向评估</strong>：Anthropic 采用了“结果为主，过程为辅”的评估策略，主要检查 Agent 最终给出的答案是否正确完整，以及过程是否大致合理，而不强求每一步都按预定的方案。</p></li><li><p><strong>及时的小样本测试</strong>： Anthropic 强调应该尽早开始评估，即使只有少量的测试用例。在开发的早期，由于Prompt 调整往往对性能影响很大，所以只需要几十个例子就能看出变化。事实证明，这种少样本快速迭代有助于迅速定位问题，验证改进，无需等到系统成熟时才搞大规模评测。等到后期模型稳定了，再引入更大规模的评测集合。这种循序渐进的评估方法保证了开发过程中有持续的客观反馈。</p></li><li><p><strong>模型自动评审</strong>：<span style="background-color:#cdedad;color:#000;padding:2px 4px">这个算是大模型时代最经典，也是最常用的评测方法。</span> 由于Research 任务的特殊性，不存在唯一的正确答案，用传统的程序去判分是很难的，所以 Anthropic 用了这种方法，并且设定了一个评分标准，涵盖以下几个维度：</p><ul><li><strong>事实准确性</strong>：回答中的陈述是否都与来源相符，没有杜撰或者夸大</li><li><strong>引用正确性</strong>：提供的引用是否真支持了对应的说法，引用位置是否准确</li><li><strong>完整性</strong>：用户请求的各方面是否都覆盖，没遗漏重要部分</li><li><strong>来源质量</strong>：所使用的资料来源是否高质量且权威</li><li><strong>工具效率</strong>： 智能体是否用了恰当数量的工具调用，没有明显浪费或遗漏可用工具。</li></ul></li></ol><p>评审模型会根据这些标准给出打分（0.0 到 1.0），并给出通过或者未通过的判断。Anthropic 尝试通过用多个模型分别不同维度来进行评分，后来发现让模型一次性给综合评分效果最好，与人类判断最一致。这种方法最大的优势就是省去了人工逐条检查的成本，保证了评估的可扩展性。</p><ol start=4><li><p><strong>人工测试与反馈</strong>：<span style="background-color:#cdedad;color:#000;padding:2px 4px">尽管自动评估很有用，但是人工评测也不可或缺。</span>人类测试者往往能发现模型的一些细节微妙的问题，例如：输出中隐藏的幻觉、某个问题导致系统崩溃、或者来源选择上的偏见。<span style="background-color:#cdedad;color:#000;padding:2px 4px">针对这些bad case， Anthropic 会通过调整 Prompt 或者改进工具来修正问题。总的来说，自动化+人工的结合让评估既有广度又有深度。</span></p></li><li><p><strong>可观测性与日志调试</strong>：调试多智能体系统的困难之处在于它们的行为具有非确定性。每次运行可能都是不同的，而且涉及到很多的交互步骤。Anthropic 的方法是为系统环境添加详细地跟踪日志。这些跟踪日志方便开发者时候定位问题，进行分析；此外，思考模式下也有助于开发者们快速定位问题。</p></li><li><p><strong>用模型调试模型</strong>：如果说用模型评判输出质量是让模型来做裁判，那用模型来调试模型，就是让它们来做 debug。比如，将一个失败的 case 的日志和 Prompt 交给 Claude，问他“为什么这里 Lead Agent”没有找到明显的信息，模型可能会帮助你进行分析，给你一个分析报告。当然，最终需要人来确认并且验证这些分析。</p></li></ol><hr><h2 id=生产环境中的挑战与工程应对>生产环境中的挑战与工程应对<a hidden class=anchor aria-hidden=true href=#生产环境中的挑战与工程应对>#</a></h2><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">将一个多智能体系统从实验室推向生产，存在许多工程上的挑战。</span></p><p><strong>挑战一：高额 Token 成本</strong></p><p>基本上所有的多智能体系统都会遇到这个问题。因为需要同时运行多个智能体，并且往往需要多轮对话和大量内容，这导致 Token 的消耗量陡增。根据 Anthropic 自己的数据显示，一个多智能体研究系统平均用掉的 Token 量是普通单智能体的 15 倍左右。这会给用户造成很大的经济压力。</p><p>Anthropic 的做法是：<span style="background-color:#cdedad;color:#000;padding:2px 4px">首先，挑选高价值场景。</span>它们将 claude 的多智能体功能聚焦在价值足够高的问题上，比如商业情报、专业研究等，因为用户愿意为高质量答案付出更高成本。 对于简单问答，Claude仍使用单Agent模式，这样把宝贵的Token预算用在刀刃上。<span style="background-color:#cdedad;color:#000;padding:2px 4px">其次，提升模型效率。</span> Anthropic不断升级模型（如从Claude 3.7升级到Claude 4），因为更强的模型能在相同Token预算下完成更多任务。</p><p><strong>挑战二：长期状态与错误恢复</strong></p><p>多智能体系统因为运行时间长，经历的步骤多，中间任何一个步骤出现问题，都会毁掉整个过程。例如：一个Subagent 卡住或者工具调用失败，往往会使后续的流程都白费。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">Anthropic 的做法是设计容错和恢复机制。</span> 例如：在一个流程中，某个 Subagent 由于网络问题中止运转，Lead Agent 并不会简单放弃任务，而是收到一个错误信号提示，然后尝试调整计划或重试。这背后涉及到多智能体系统框架的支持：要保存每个智能体的重要状态，在必要时重启系统能够继续上下文，而不是一切归零。</p><p><strong>挑战三：调试难度和可追踪性</strong></p><p>前面其实提到过，多智能体系统之间的交互和决策具有不确定性，使得调试定位问题非常困难 。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">Anthropic在生产环境中投入了大量工作以增强系统的可追踪性。他们实现了全面的运行跟踪日志，包括每个智能体的每次思考内容（隐式地，可以选择记录Extended Thinking输出）、使用了哪个工具、返回了什么结果、Lead Agent做了什么决定等。这些日志在生产中实时收集，以供线下分析。</span></p><p>当用户报告“Claude没找到显而易见的信息”时，开发者可以检索日志看看：是不是Agent用了不好的搜索词？是不是选错了来源？还是某个工具出错？事实证明，开启详细追踪后，大部分此类问题都能找到根源 。例如，有次Claude漏掉了一部分答案，日志显示它其实找到了但在综合时误判丢弃了——针对这种情况，团队后来调整了Prompt权重，让Lead Agent更重视全面性。这种数据驱动的调试极大提升了修复效率。</p><p>不仅如此，Anthropic还开发了高层监控指标来捕捉系统行为模式，如平均每次查询创建的Subagent 数量、平均每个Subagent 调用的工具次数等。这些指标如果出现异常暴增，往往预示有bug或Prompt问题，在用户发现之前开发者就能预警并介入处理。</p><p><strong>挑战四：部署更新的复杂性</strong></p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">多智能体系统本质上是由大量Prompt、工具接口和执行逻辑组成的复杂网络，并且是高度有状态、长时间运行的。</span>这给代码或Prompt的上线更新带来了巨大的挑战。 当我们更新系统时，可能有许多智能体正处于中间状态，不能简单进行重启 。</p><p>Anthropic为此采用了<span style="background-color:#cdedad;color:#000;padding:2px 4px">渐进式部署（rainbow deploy) 技术 。</span> 简单来说，就是当发布新版本时，不会立刻把所有流量都切到新版本，而是让一部分新请求使用新版，老的仍用旧版，逐渐增加新版比例 。同时，已经在跑的老版本智能体继续跑完不受干扰。这类似于“彩虹”渐变，保证系统平滑过渡，避免中断正在进行的对话 。此外，在部署前团队会特别留意那些Prompt或代码的改动会如何影响智能体行为，通过模拟测试来验证不会导致新问题。总之，他们把部署看做一个需要精心策划的过程，以免“一刀切”更新导致用户的多轮对话过程被中断或行为骤变。</p><p><strong>挑战五：同步架构的瓶颈</strong></p><p>当前整个多智能体研究系统的 Lead Agent与Subagent 协调采取的是同步轮次的方式：Lead Agent一次发起一批Subagent，然后等待所有完成后再进行下一步 。这种做法的好处是简单，Lead Agent可以统一整合一批结果再决定后续动作。但缺点也明显：存在等待瓶颈。比如，如果有一个Subagent别慢，Lead Agent和其他 Subagent 都得干等。另外，Lead Agent在Subagent 执行期间无法介入指导，Subagent之间也不能互相协调 。整个系统实际上被分成了隔离的一轮轮。在一些任务中，这降低了效率和灵活性。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">Anthropic已经意识到，异步执行也许是未来的发展方向</span>：允许Lead Agent 不必等所有 Subagent 都结束就先处理部分结果，或者根据实时情况再派出新的Subagent ；Subagent 之间若能共享一些中间发现，可能少走重复路。当然，实现异步会大大增加协调难度，涉及并发管理、状态一致性、错误传播等复杂问题 。</p><p>Anthropic判断，随着模型能力增强，可以承担更复杂的长程任务时，异步架构带来的性能提升将值得那时去实现 。但在当前，他们权衡利弊选择了同步方案，并通过增加并行度尽可能降低等待影响。</p><p><strong>挑战六：上下文和长对话管理</strong></p><p>多智能体系统涉及超长的对话（动辄上百轮的工具交互），而大模型本身的上下文窗口是有限的。这带来了上下文管理挑战：如何不丢失关键信息，又避免超长上下文超出模型能力？</p><p>Anthropic的解决方案是<span style="background-color:#cdedad;color:#000;padding:2px 4px">引入智能的摘要与内存机制</span> 。正如前面提到的，Lead Agent会在完成某阶段任务后，将当前进展和计划总结存储到Memory，然后开始新的阶段 。如果上下文长度接近极限，Lead Agent 就生成新的 Subagent，从干净上下文开始，同时通过Memory把必要的背景传递过去 。例如，当Lead Agent已经对某部分完成调查后，它可以让一个新的智能体在没有历史包袱的情况下继续下一个部分。这样，通过阶段性重置和记忆提取，他们避免了单个对话无限膨胀导致模型遗忘前面内容或截断。这种分布式上下文管理方式使Claude能够处理更长、更复杂的任务。同时也是对真实生产场景的考量：如果用户长时间与多智能体系统交互，必须保证<strong>上下文一致性和性能</strong>。</p><p><strong>挑战七：结果传输的损耗</strong></p><p>Anthropic注意到，在多层智能体传递信息的过程中，可能出现“传话游戏”效应：如果Subagent 找到一大段有用资料，但只能通过Lead Agent摘要转述给用户，可能信息有损，还浪费Token。</p><p><span style="background-color:#cdedad;color:#000;padding:2px 4px">在生产中，他们引入了一种 Subagent 直接产出交付的机制。</span> 具体而言，对于某些结构化输出（例如代码片段、长报告、数据表格），子代理可以直接把结果保存到共享的外部存储（比如文件系统或数据库），然后把引用指针给Lead Agent 。Lead Agent拿到指针后，可以将结果直接嵌入最终答案，或者提供给用户下载/查看 。</p><p>这样，避免了Lead Agent必须读一遍子代理长输出再复述，既提高了保真度又减少了Token开销 。<span style="background-color:#cdedad;color:#000;padding:2px 4px"> 例如，一个代码生成的 Subagent 可以把代码写入文件，Lead Agent只需要简单描述结果并附上文件链接，而不用占用自己上下文重复代码内容。</span>这种“旁路”传输方法在工程上提高了效率，也为多智能体协作提供了新的模式：专业子代理直接交付其专业产出。</p><p>通过以上种种措施，Anthropic克服了很多工程上的挑战，使得多智能体系统能够稳定、高效地运行在生产环境。这些经验表明，要让多智能体系统真正可用，除了让AI变聪明，还需要大量脚踏实地的工程工作：考虑资源和成本、建立健壮的运行机制、确保系统可维护可扩展等等。这些都是将原型转化为可靠产品的关键步骤。</p><hr><h2 id=写在最后>写在最后<a hidden class=anchor aria-hidden=true href=#写在最后>#</a></h2><p>好啦，今天的分享就先到这儿了～</p><p>像Anthropic 这类公司的博客强烈建议大家都去读一下原文，因为它们的文章中包含了它们大量的实践经验，以及对未来 AI 发展的思考和判断，这些无论是对企业的业务落地还是个人的 AI 素质提升，都具有很强的指导意义。</p><p><span style=color:red>感谢您读到这里！若觉得内容有帮助，欢迎点赞、在看、关注。别错过更新，给公众号加个星标⭐️吧！期待与您的下次相遇～</span></p></div></div><aside class="post-aside toc-desktop"><div class=toc><div class=inner><nav id=TableOfContents><ul><li><a href=#架构设计>架构设计</a></li><li><a href=#提示词设计原则>提示词设计原则</a></li><li><a href=#多智能体系统评估与调试方法>多智能体系统评估与调试方法</a></li><li><a href=#生产环境中的挑战与工程应对>生产环境中的挑战与工程应对</a></li><li><a href=#写在最后>写在最后</a></li></ul></nav></div></div></aside></div><footer class=post-footer><ul class=post-tags><li><a href=https://bubblebrain.me/tags/ai/>AI</a></li><li><a href=https://bubblebrain.me/tags/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93/>多智能体</a></li><li><a href=https://bubblebrain.me/tags/anthropic/>Anthropic</a></li><li><a href=https://bubblebrain.me/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/>公众号</a></li></ul><nav class=paginav><a class=prev href=https://bubblebrain.me/posts/%E4%B8%8A%E4%B8%8B%E6%96%87%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%85%B4%E8%B5%B7/><span class=title>« Prev</span><br><span>上下文工程的兴起</span>
</a><a class=next href=https://bubblebrain.me/posts/notes-on-lightrag/><span class=title>Next »</span><br><span>Notes on LightRAG</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on x" href="https://x.com/intent/tweet/?text=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89&amp;url=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f&amp;hashtags=AI%2c%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%2cAnthropic%2c%e5%85%ac%e4%bc%97%e5%8f%b7"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f&amp;title=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89&amp;summary=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89&amp;source=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f&title=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on whatsapp" href="https://api.whatsapp.com/send?text=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89%20-%20https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on telegram" href="https://telegram.me/share/url?text=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89&amp;url=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 深度解密：Anthropic多智能体系统背后的原理及提示词工程（建议收藏） on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e6%b7%b1%e5%ba%a6%e8%a7%a3%e5%af%86%ef%bc%9aAnthropic%e5%a4%9a%e6%99%ba%e8%83%bd%e4%bd%93%e7%b3%bb%e7%bb%9f%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e6%8f%90%e7%a4%ba%e8%af%8d%e5%b7%a5%e7%a8%8b%ef%bc%88%e5%bb%ba%e8%ae%ae%e6%94%b6%e8%97%8f%ef%bc%89&u=https%3a%2f%2fbubblebrain.me%2fposts%2f%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E5%25AF%2586anthropic%25E5%25A4%259A%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25B3%25BB%25E7%25BB%259F%25E8%2583%258C%25E5%2590%258E%25E7%259A%2584-%25E5%258E%259F%25E7%2590%2586%25E5%258F%258A%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D%25E5%25B7%25A5%25E7%25A8%258B%25E5%25BB%25BA%25E8%25AE%25AE%25E6%2594%25B6%25E8%2597%258F%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div class=giscus-comments><h3>评论</h3><div class=giscus></div><script>(function(){function e(){return localStorage.getItem("pref-theme")==="dark"||!localStorage.getItem("pref-theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}const s=e(),o={src:"https://giscus.app/client.js","data-repo":"DylanDDeng/BubbleBrain","data-repo-id":"R_kgDOPC9mIQ","data-category":"Announcements","data-category-id":"DIC_kwDOPC9mIc4CsHPR","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":s==="dark"?"dark":"light","data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous",async:""},t=document.createElement("script");Object.entries(o).forEach(([e,n])=>t.setAttribute(e,n)),document.querySelector(".giscus").appendChild(t);const n=document.getElementById("theme-toggle");n&&n.addEventListener("click",function(){const t=document.querySelector(".giscus-frame");if(t){const n=e()==="dark"?"light":"dark";t.contentWindow.postMessage({giscus:{setConfig:{theme:n}}},"https://giscus.app")}})})()</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://bubblebrain.me/>BubbleBrain</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>